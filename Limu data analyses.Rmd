---
title: "R Notebook"
output: html_notebook
---
```{r}
rm(list = ls())
```

```{r}
library(dplyr)
library(tidyr)
library(Rmisc)
library(lubridate)
library(ggplot2)
library(car)
library(MASS)
library(mgcv)
library(MuMIn)
library(emmeans)
```

#Seawater nutrients
```{r}
nut<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Sample inventory for seawater nutrients_DOC.csv", strip.white=T)
nut$Date<-as.Date(nut$Date)
nut$NO3_N_ppb <- ifelse(nut$NO3_N_ppb != 0, nut$NO3_N_ppb / .226, nut$NO3_N_ppb)
nut$Week_Number <- week(nut$Date)
nut <- nut %>%
  filter(Date != "2024-06-12")
nut
```
##Ammonium
####Stats
```{r}
nut.lme <- lme(NH3_4_N_ppb~Where*Treatment,random = ~1|Tank, data=nut, na.action=na.exclude)
Anova(nut.lme, type=3)
tukey<- emmeans(nut.lme, list(pairwise ~ Treatment:Where), adjust = "tukey")
tukey
```
```{r}
NH3_4_N_ppb_sum<- summarySE(nut, measurevar='NH3_4_N_ppb', groupvars=c('Treatment', "Date", "Where"), na.rm=TRUE, conf.interval = 0.95)
NH3_4_N_ppb_sum
```
####Figure
```{r}
NH3_4_N_ppb_figure<-ggplot(NH3_4_N_ppb_sum, aes(y=NH3_4_N_ppb, x=Date, color=Treatment))+ 
  geom_point(data=nut, aes(y=NH3_4_N_ppb,x=Date, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path()+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=NH3_4_N_ppb-se, ymax=NH3_4_N_ppb+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  #scale_y_continuous(expression(Relative~change~'in'~surface~area~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01),breaks=c(-0.2,-0.1,0,0.1,0.2,0.3,0.4), limits=c(-0.2,0.4))+ 
  scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  facet_wrap(~Where, scales="free")+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(0.15,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NH3_4_N_ppb_figure
```

```{r}
NH3_4_N_ppb_sum2<- summarySE(nut, measurevar='NH3_4_N_ppb', groupvars=c('Treatment', "Where"), na.rm=TRUE, conf.interval = 0.95)
NH3_4_N_ppb_sum2
```

```{r}
NO3_N_ppb_figure2<-ggplot(nut, aes(y=NO3_N_ppb, x=Treatment, color=Treatment, fill=Treatment))+ 
  geom_boxplot(color="black",outlier.shape =NA, alpha=0.4)+
  geom_point(data=nut, aes(y=NO3_N_ppb,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  #geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  #geom_errorbar(aes(ymin=NO3_N_ppb-se, ymax=NO3_N_ppb+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  #scale_y_continuous(expression(Relative~change~'in'~surface~area~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01),breaks=c(-0.2,-0.1,0,0.1,0.2,0.3,0.4), limits=c(-0.2,0.4))+ 
  scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  scale_fill_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  facet_wrap(~Where, scales="free")+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NO3_N_ppb_figure2
```

##Nitrate
####Stats
```{r}
nut2.lme <- lme(NO3_N_ppb~Where*Treatment,random = ~1|Tank, data=nut, na.action=na.exclude)
Anova(nut2.lme, type=3)
tukey<- emmeans(nut2.lme, list(pairwise ~ Treatment:Where), adjust = "tukey")
tukey
```

```{r}
NO3_N_ppb_sum<- summarySE(nut, measurevar='NO3_N_ppb', groupvars=c('Treatment', "Date", "Where"), na.rm=TRUE, conf.interval = 0.95)
NO3_N_ppb_sum
```
####Figure
```{r}
NO3_N_ppb_figure<-ggplot(NO3_N_ppb_sum, aes(y=NO3_N_ppb, x=Date, color=Treatment))+ 
  geom_point(data=nut, aes(y=NO3_N_ppb,x=Date, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path()+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=NO3_N_ppb-se, ymax=NO3_N_ppb+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  #scale_y_continuous(expression(Relative~change~'in'~surface~area~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01),breaks=c(-0.2,-0.1,0,0.1,0.2,0.3,0.4), limits=c(-0.2,0.4))+ 
  scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  facet_wrap(~Where, scales="free")+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NO3_N_ppb_figure
```
```{r}
NO3_N_ppb_sum2<- summarySE(nut, measurevar='NO3_N_ppb', groupvars=c('Treatment',  "Where"), na.rm=TRUE, conf.interval = 0.95)
NO3_N_ppb_sum2
```

##Phosphate
####Stats
```{r}
nut3.lme <- lme(PO4_SRP_ppb_run_1~Where*Treatment,random = ~1|Tank, data=nut, na.action=na.exclude)
Anova(nut3.lme, type=3)
tukey<- emmeans(nut3.lme, list(pairwise ~ Treatment:Where), adjust = "tukey")
tukey
```

```{r}
PO4_SRP_ppb_run_1_sum<- summarySE(nut, measurevar='PO4_SRP_ppb_run_1', groupvars=c('Treatment', "Date", "Where"), na.rm=TRUE, conf.interval = 0.95)
PO4_SRP_ppb_run_1_sum
```
####Figure
```{r}
PO4_SRP_ppb_run_1_figure<-ggplot(PO4_SRP_ppb_run_1_sum, aes(y=PO4_SRP_ppb_run_1, x=Date, color=Treatment))+ 
  geom_point(data=nut, aes(y=PO4_SRP_ppb_run_1,x=Date, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path()+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=PO4_SRP_ppb_run_1-se, ymax=PO4_SRP_ppb_run_1+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  #scale_y_continuous(expression(Relative~change~'in'~surface~area~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01),breaks=c(-0.2,-0.1,0,0.1,0.2,0.3,0.4), limits=c(-0.2,0.4))+ 
  scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  facet_wrap(~Where, scales="free")+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
PO4_SRP_ppb_run_1_figure
```
```{r}
PO4_SRP_ppb_run_1_sum2<- summarySE(nut, measurevar='PO4_SRP_ppb_run_1', groupvars=c('Treatment', "Where"), na.rm=TRUE, conf.interval = 0.95)
PO4_SRP_ppb_run_1_sum2
```

```{r}
library(cowplot)
nut_all<-cowplot::plot_grid(NH3_4_N_ppb_figure,NO3_N_ppb_figure,PO4_SRP_ppb_run_1_figure,nrow=3,ncol=1,align="h", axis = "bt")
nut_all
```
#NPOC
```{r}
npoc<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu_NPOC_TNb_data.csv", strip.white=T)
metadata<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Sample inventory for seawater nutrients_DOC - Sheet1.csv", strip.white=T)
metadata$Date<-as.Date(metadata$Date)
metadata<- plyr::rename(metadata, c("DOC_run_order"="Sample_ID"))
metadata$Sample_ID<- as.factor(metadata$Sample_ID)
metadata$Where<- as.factor(metadata$Where)
metadata$Treatment<- as.factor(metadata$Treatment)
metadata$Tank<- as.factor(metadata$Tank)
metadata$Week_Number <- week(metadata$Date)
metadata$Week_Number<- as.factor(metadata$Week_Number)
npoc$Replicate<- as.factor(npoc$Replicate)
npoc$Sample_ID<- as.factor(npoc$Sample_ID)

metadata
npoc
merged_npoc <- merge(metadata, npoc, by=c("Sample_ID"), all=T)
npoc_avg <- merged_npoc %>%
  dplyr::group_by(Where, Treatment, Date, Tank, Replicate, Week_Number) %>%
  dplyr::summarize(NPOC = mean(NPOC_ppm_without_high), .groups = "drop")
npoc_avg
tn_avg <- merged_npoc %>%
  dplyr::group_by(Where, Treatment, Date, Tank, Replicate, Week_Number) %>%
  dplyr::summarize(TN = mean(TNb_ppm_without_high), .groups = "drop")
tn_avg
npoc_avg <- npoc_avg[npoc_avg$Date != "2024-05-29", ]
tn_avg <- tn_avg[tn_avg$Date != "2024-05-29", ]
```
```{r}
NPOC_sum<-summarySE(npoc_avg, measurevar='NPOC', groupvars=c("Where", "Treatment"), na.rm=TRUE, conf.interval = 0.95)
NPOC_sum
```

```{r}
TN_sum<-summarySE(tn_avg, measurevar='TN', groupvars=c("Where", "Treatment"), na.rm=TRUE, conf.interval = 0.95)
TN_sum
```


####Stats
```{r}
npoc.lme <- lme(NPOC~Where*Treatment,random = ~1|Tank, data=npoc_avg, na.action=na.exclude)
Anova(npoc.lme, type=3)
tukey<- emmeans(npoc.lme, list(pairwise ~ Treatment:Where), adjust = "tukey")
tukey
```
####Stats
```{r}
tn.lme <- lme(TN~Where*Treatment,random = ~1|Tank, data=tn_avg, na.action=na.exclude)
Anova(tn.lme, type=3)
tukey<- emmeans(tn.lme, list(pairwise ~ Treatment:Where), adjust = "tukey")
tukey
```
#Waikalua - seawater nutrients

```{r}
nut_all<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Sample inventory for seawater nutrients_DOC.csv", strip.white=T)
nut_all$Date<-as.Date(nut_all$Date)
nut_all$NO3_N_ppb <- ifelse(nut_all$NO3_N_ppb != 0, nut_all$NO3_N_ppb / .226, nut_all$NO3_N_ppb)
nut_all$Week_Number <- week(nut_all$Date)
nut_wai <- nut_all%>%
  filter(Where != "HIMB")
nut_wai
```

##Ammonium
####Stats
```{r}
nut_wai.lme <- lm(NH3_4_N_ppb~Treatment, data=nut_wai, na.action=na.exclude)
Anova(nut_wai.lme)
tukey<- emmeans(nut_wai.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```
```{r}
NH3_4_N_ppb_sum<- summarySE(nut_wai, measurevar='NH3_4_N_ppb', groupvars=c('Treatment', "Date"), na.rm=TRUE, conf.interval = 0.95)
NH3_4_N_ppb_sum
```
####Figure
```{r}
NH3_4_N_ppb_figure<-ggplot(NH3_4_N_ppb_sum, aes(y=NH3_4_N_ppb, x=Date, color=Treatment))+ 
  geom_point(data=nut_wai, aes(y=NH3_4_N_ppb,x=Date, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path()+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=NH3_4_N_ppb-se, ymax=NH3_4_N_ppb+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  #scale_y_continuous(expression(Relative~change~'in'~surface~area~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01),breaks=c(-0.2,-0.1,0,0.1,0.2,0.3,0.4), limits=c(-0.2,0.4))+ 
  scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  facet_wrap(~Where, scales="free")+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(0.15,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NH3_4_N_ppb_figure
```

#Seawater nutrients - no Waikalua

##NPOC

```{r}
npoc_himb <- npoc_avg%>%
  filter(Where != "Waikalua")%>%
  filter(Date != "2024-06-12")%>%
  group_by(Treatment,Date,Tank, Week_Number)%>%
  dplyr::summarize(NPOC = mean(NPOC), .groups = "drop")
npoc_himb
```
####Stats
```{r}
npoc_himb.lme <- lme(NPOC~Treatment*Week_Number,random = ~1|Tank, data=npoc_himb, na.action=na.exclude)
Anova(npoc_himb.lme, type=3)
tukey<- emmeans(npoc_himb.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```
```{r}
npoc_sum<- summarySE(npoc_himb, measurevar='NPOC', groupvars=c('Treatment', "Date"), na.rm=TRUE, conf.interval = 0.95)
npoc_sum
```
####Figure
```{r}
NPOC_figure<-ggplot(npoc_sum, aes(y=NPOC, x=Date, color=Treatment))+ 
  geom_point(data=npoc_himb, aes(y=NPOC,x=Date, color=Treatment),alpha=0.5)+
  geom_path()+
  geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=NPOC-se, ymax=NPOC+se, width= 2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Dissolved~organic~carbon~(ppm)), expand = c(0.01,0.01), limits=c(0,8))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NPOC_figure
```
```{r}
NPOC_sum2<- summarySE(npoc_himb, measurevar='NPOC', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
NPOC_sum2
```
####Figure
```{r}
NPOC_figure2<-ggplot(NPOC_sum2, aes(y=NPOC, x=Treatment, color=Treatment))+ 
  #geom_point(data=npoc_himb, aes(y=NPOC,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  #geom_path()+
  geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=NPOC-se, ymax=NPOC+se, width= 0.1),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Dissolved~organic~carbon~(ppb)), expand = c(0.01,0.01), limits=c(0,3))+ 
   scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NPOC_figure2
```
####Figure
```{r}
NPOC_figure2<-ggplot(npoc_sum, aes(y=NPOC, x=Date, color=Treatment, fill=Treatment))+ 
  #geom_point(data=npoc_himb, aes(y=NPOC,x=Date, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_line()+
  geom_ribbon(aes(ymin=NPOC-se, ymax=NPOC+se), alpha=0.6)+
  #geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  #geom_ribbon(aes(ymin=NPOC-se, ymax=NPOC+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Dissolved~organic~carbon~(ppm)), expand = c(0.01,0.01), limits=c(0,5))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position=c(0.1,0.85), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NPOC_figure2
```
##TN

```{r}
TN_himb <- tn_avg%>%
  filter(Where != "Waikalua")%>%
  filter(Date != "2024-06-12")%>%
  group_by(Treatment,Date,Tank,Week_Number)%>%
  dplyr::summarize(TN = mean(TN), .groups = "drop")
TN_himb
```
####Stats
```{r}
TN_himb.lme <- lme(TN~Treatment*Week_Number,random = ~1|Tank, data=TN_himb, na.action=na.exclude)
Anova(TN_himb.lme, type=3)
tukey<- emmeans(TN_himb.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```
```{r}
TN_sum<- summarySE(TN_himb, measurevar='TN', groupvars=c('Treatment', "Date"), na.rm=TRUE, conf.interval = 0.95)
TN_sum
```
####Figure
```{r}
TN_figure<-ggplot(TN_sum, aes(y=TN, x=Date, color=Treatment))+ 
  geom_point(data=TN_himb, aes(y=TN,x=Date, color=Treatment),alpha=0.5)+
  geom_path()+
  geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=TN-se, ymax=TN+se, width= 2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Total~nitrogen~(ppm)), expand = c(0.01,0.01), limits=c(0,0.8))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position=c(0.1,0.85), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
TN_figure
```
```{r}
TN_sum2<- summarySE(TN_himb, measurevar='TN', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
TN_sum2
```
####Figure
```{r}
TN_figure2<-ggplot(TN_sum2, aes(y=TN, x=Treatment, color=Treatment))+ 
  #geom_point(data=TN_himb, aes(y=TN,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  #geom_path()+
  geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=TN-se, ymax=TN+se, width= 0.1),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Dissolved~total~nitrogen~(ppb)), expand = c(0.01,0.01), limits=c(0,0.3))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
TN_figure2
```
####Figure
```{r}
TN_figure2<-ggplot(TN_sum, aes(y=TN, x=Date, color=Treatment, fill=Treatment))+ 
  #geom_point(data=npoc_himb, aes(y=NPOC,x=Date, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_line()+
  geom_ribbon(aes(ymin=TN-se, ymax=TN+se), alpha=0.6)+
  #geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  #geom_ribbon(aes(ymin=NPOC-se, ymax=NPOC+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Dissolved~organic~carbon~(ppm)), expand = c(0.01,0.01))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position=c(0.1,0.85), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
TN_figure2
```


```{r}
library(cowplot)
nut_all_himb<-cowplot::plot_grid(NPOC_figure,NPOC_figure2,TN_figure,TN_figure2,nrow=2,ncol=2,align="h", axis = "bt")
nut_all_himb
```


```{r}
nut_himb <- nut%>%
  filter(Where != "Waikalua")%>%
  filter(Date != "2024-06-12")
nut_himb$Week_Number<-as.factor(nut_himb$Week_Number)
nut_himb
```

##Ammonium
####Stats
```{r}
nut_himb.lme <- lme(NH3_4_N_ppb~Treatment*Week_Number,random = ~1|Tank, data=nut_himb, na.action=na.exclude)
Anova(nut_himb.lme, type=3)
tukey<- emmeans(nut_himb.lme, list(pairwise ~ Treatment*Week_Number), adjust = "tukey", simple="Treatment")
tukey
```

```{r}
NH3_4_N_ppb_sum<- summarySE(nut_himb, measurevar='NH3_4_N_ppb', groupvars=c('Treatment', "Date"), na.rm=TRUE, conf.interval = 0.95)
NH3_4_N_ppb_sum
```
####Figure
```{r}
NH3_4_N_ppb_figure<-ggplot(NH3_4_N_ppb_sum, aes(y=NH3_4_N_ppb, x=Date, color=Treatment))+ 
  geom_point(data=nut_himb, aes(y=NH3_4_N_ppb,x=Date, color=Treatment),alpha=0.5)+
  geom_path()+
  geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=NH3_4_N_ppb-se, ymax=NH3_4_N_ppb+se, width= 2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Ammonia~(ppb)), expand = c(0.01,0.01), limits=c(0,20))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position=c(0.1,0.85), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NH3_4_N_ppb_figure
```
```{r}
NH3_4_N_ppb_sum2<- summarySE(nut_himb, measurevar='NH3_4_N_ppb', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
NH3_4_N_ppb_sum2
```
####Figure
```{r}
NH3_4_N_ppb_figure_sum<-ggplot(NH3_4_N_ppb_sum2, aes(y=NH3_4_N_ppb, x=Treatment, color=Treatment))+ 
  #geom_point(data=nut_himb, aes(y=NH3_4_N_ppb,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  #geom_path()+
  geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=NH3_4_N_ppb-se, ymax=NH3_4_N_ppb+se, width= 0.1),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Ammonia~(ppb)), expand = c(0.1,0.1), limits=c(0,5), breaks=c(0,1,2,3,4,5))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NH3_4_N_ppb_figure_sum
```
```{r}
NH3_4_N_ppb_figure2<-ggplot(NH3_4_N_ppb_sum, aes(y=NH3_4_N_ppb, x=Date, color=Treatment, fill=Treatment))+ 
  #geom_point(data=nut_himb, aes(y=NH3_4_N_ppb,x=Date, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path()+
  #geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_ribbon(aes(ymin=NH3_4_N_ppb-se, ymax=NH3_4_N_ppb+se),alpha=0.6) +
  scale_y_continuous(expression(Ammonia~(ppb)), expand = c(0.01,0.01), limits=c(0,15))+ 
   scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position=c(0.1,0.85), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NH3_4_N_ppb_figure2
```

##Nitrate
####Stats
```{r}
nut_himb2.lme <- lme(NO3_N_ppb~Treatment*Week_Number,random = ~1|Tank, data=nut_himb, na.action=na.exclude)
Anova(nut_himb2.lme, type=3)
tukey<- emmeans(nut_himb2.lme, list(pairwise ~ Week_Number), adjust = "tukey")
tukey
```
```{r}
NO3_N_ppb_sum<- summarySE(nut_himb, measurevar='NO3_N_ppb', groupvars=c('Treatment', "Date", "Where"), na.rm=TRUE, conf.interval = 0.95)
NO3_N_ppb_sum
```

```{r}
NO3_N_ppb_figure<-ggplot(NO3_N_ppb_sum, aes(y=NO3_N_ppb, x=Date, color=Treatment))+ 
  geom_point(data=nut_himb, aes(y=NO3_N_ppb,x=Date, color=Treatment),alpha=0.5)+
  geom_path()+
  #geom_smooth()+
  geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=NO3_N_ppb-se, ymax=NO3_N_ppb+se, width= 2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Nitrate~(ppb)), expand = c(0.01,0.01), limits=c(0,150))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NO3_N_ppb_figure
```
```{r}
NO3_N_ppb_sum2<- summarySE(nut_himb, measurevar='NO3_N_ppb', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
NO3_N_ppb_sum2
```
####Figure
```{r}
NO3_N_ppb_figure_sum<-ggplot(NO3_N_ppb_sum2, aes(y=NO3_N_ppb, x=Treatment, color=Treatment))+ 
  #geom_point(data=nut_himb, aes(y=NH3_4_N_ppb,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  #geom_path()+
  geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=NO3_N_ppb-se, ymax=NO3_N_ppb+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Nitrate~(ppb)), expand = c(0.01,0.01),limits=c(0,40))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NO3_N_ppb_figure_sum
```
```{r}
NO3_N_ppb_figure<-ggplot(NO3_N_ppb_sum, aes(y=NO3_N_ppb, x=Date, color=Treatment, fill=Treatment))+ 
  #geom_point(data=nut_himb, aes(y=NO3_N_ppb,x=Date, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path()+
  #geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_ribbon(aes(ymin=NO3_N_ppb-se, ymax=NO3_N_ppb+se), alpha=0.6) +
  scale_y_continuous(expression(Nitrate~(ppb)), expand = c(0.01,0.01))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
NO3_N_ppb_figure
```
##Phosphate
####Stats
```{r}
nut_himb3.lme <- lme(PO4_SRP_ppb_run_1~Treatment*Week_Number,random = ~1|Tank, data=nut_himb, na.action=na.exclude)
Anova(nut_himb3.lme, type=3)
tukey<- emmeans(nut_himb3.lme, list(pairwise ~ Treatment:Week_Number), adjust = "tukey", simple="Treatment")
tukey
```

```{r}
PO4_SRP_ppb_run_1_sum<- summarySE(nut_himb, measurevar='PO4_SRP_ppb_run_1', groupvars=c('Treatment', "Date"), na.rm=TRUE, conf.interval = 0.95)
PO4_SRP_ppb_run_1_sum
```

```{r}
PO4_SRP_ppb_run_1_figure<-ggplot(PO4_SRP_ppb_run_1_sum, aes(y=PO4_SRP_ppb_run_1, x=Date, color=Treatment))+ 
  geom_point(data=nut_himb, aes(y=PO4_SRP_ppb_run_1,x=Date, color=Treatment),alpha=0.5)+
  geom_path()+
  geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=PO4_SRP_ppb_run_1-se, ymax=PO4_SRP_ppb_run_1+se, width= 2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Soluble~reactive~phosphorus~(ppb)), expand = c(0.01,0.01), limits=c(0,15))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
PO4_SRP_ppb_run_1_figure
```
```{r}
PO4_SRP_ppb_run_1_sum2<- summarySE(nut_himb, measurevar='PO4_SRP_ppb_run_1', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
PO4_SRP_ppb_run_1_sum2
```
####Figure
```{r}
PO4_SRP_ppb_run_1_figure2<-ggplot(PO4_SRP_ppb_run_1_sum2, aes(y=PO4_SRP_ppb_run_1, x=Treatment, color=Treatment))+ 
  #geom_point(data=nut_himb, aes(y=NH3_4_N_ppb,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  #geom_path()+
  geom_point(size=2, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=PO4_SRP_ppb_run_1-se, ymax=PO4_SRP_ppb_run_1+se, width= 0.1),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Soluble~reactive~phosphorus~(ppb)), expand = c(0.01,0.01), limits=c(0,3))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        #legend.title = element_text(size=12),
        #legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
PO4_SRP_ppb_run_1_figure2
```

```{r}
library(cowplot)
nut_all_himb_firstrow<-cowplot::plot_grid(NH3_4_N_ppb_figure,NO3_N_ppb_figure,PO4_SRP_ppb_run_1_figure, nrow=1,ncol=3,align="h", axis = "bt")
nut_all_himb_firstrow
```

```{r}
library(cowplot)
nut_all_himb<-cowplot::plot_grid(NH3_4_N_ppb_figure_sum,NO3_N_ppb_figure_sum,PO4_SRP_ppb_run_1_figure2,NPOC_figure2, TN_figure2, nrow=1,ncol=5,align="h", axis = "bt")
nut_all_himb
```
```{r}
nut_all_himb_all<-cowplot::plot_grid(nut_all_himb_firstrow, nut_all_himb, nrow=4,ncol=1,align="h", axis = "bt")
nut_all_himb_all
```

```{r}
datalog<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-03_Datalog_longer.csv", strip.white=T)
datalog$date <- as.POSIXct(datalog$date, format = "%m/%d/%Y %H:%M")
datalog$date <- format(datalog$date, "%Y-%m-%d %H:%M:%S")
datalog$date <- as.POSIXct(datalog$date, format = "%Y-%m-%d %H:%M:%S")
datalog<- plyr::rename(datalog, c("date"="Date_Time"))
datalog <- datalog %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog$Treatment <- ifelse(datalog$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog<- plyr::rename(datalog, c("name"="Tank"))
datalog$Treatment<-as.factor(datalog$Treatment)
datalog$Tank<-as.factor(datalog$Tank)
datalog$value<-as.character(datalog$value)
datalog <- datalog %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog) - 1))
datalog
```
```{r}
datalog_2<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-02_datalog.csv", strip.white=T)
datalog_2$date <- as.POSIXct(datalog_2$date, format = "%m/%d/%Y %H:%M:%S")
datalog_2$date <- format(datalog_2$date, "%Y-%m-%d %H:%M:%S")
datalog_2$date <- as.POSIXct(datalog_2$date, format = "%Y-%m-%d %H:%M:%S")
datalog_2<- plyr::rename(datalog_2, c("date"="Date_Time"))
datalog_2 <- datalog_2 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_2$Treatment <- ifelse(datalog_2$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_2<- plyr::rename(datalog_2, c("name"="Tank"))
datalog_2$Treatment<-as.factor(datalog_2$Treatment)
datalog_2$Tank<-as.factor(datalog_2$Tank)
datalog_2$value<-as.character(datalog_2$value)
datalog_2 <- datalog_2 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_2) - 1))
datalog_2
```
```{r}
datalog_3<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-06_datalog.csv", strip.white=T)
datalog_3$date <- as.POSIXct(datalog_3$date, format = "%m/%d/%Y %H:%M")
datalog_3$date <- format(datalog_3$date, "%Y-%m-%d %H:%M:%S")
datalog_3$date <- as.POSIXct(datalog_3$date, format = "%Y-%m-%d %H:%M:%S")
datalog_3<- plyr::rename(datalog_3, c("date"="Date_Time"))
datalog_3 <- datalog_3 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_3$Treatment <- ifelse(datalog_3$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_3<- plyr::rename(datalog_3, c("name"="Tank"))
datalog_3$Treatment<-as.factor(datalog_3$Treatment)
datalog_3$Tank<-as.factor(datalog_3$Tank)
datalog_3$value<-as.character(datalog_3$value)
datalog_3 <- datalog_3 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_3) - 1))
datalog_3
```

```{r}
datalog_4<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-13_datalog.csv", strip.white=T)
datalog_4$date <- as.POSIXct(datalog_4$date, format = "%m/%d/%Y %H:%M")
datalog_4$date <- format(datalog_4$date, "%Y-%m-%d %H:%M:%S")
datalog_4$date <- as.POSIXct(datalog_4$date, format = "%Y-%m-%d %H:%M:%S")
datalog_4<- plyr::rename(datalog_4, c("date"="Date_Time"))
datalog_4 <- datalog_4 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_4$Treatment <- ifelse(datalog_4$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_4<- plyr::rename(datalog_4, c("name"="Tank"))
datalog_4$Treatment<-as.factor(datalog_4$Treatment)
datalog_4$Tank<-as.factor(datalog_4$Tank)
datalog_4$value<-as.character(datalog_4$value)
datalog_4 <- datalog_4 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_4) - 1))
datalog_4
```
```{r}
datalog_5<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-15_datalog.csv", strip.white=T)
datalog_5$date <- as.POSIXct(datalog_5$date, format = "%m/%d/%Y %H:%M")
datalog_5$date <- format(datalog_5$date, "%Y-%m-%d %H:%M:%S")
datalog_5$date <- as.POSIXct(datalog_5$date, format = "%Y-%m-%d %H:%M:%S")
datalog_5<- plyr::rename(datalog_5, c("date"="Date_Time"))
datalog_5 <- datalog_5 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_5$Treatment <- ifelse(datalog_5$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_5<- plyr::rename(datalog_5, c("name"="Tank"))
datalog_5$Treatment<-as.factor(datalog_5$Treatment)
datalog_5$Tank<-as.factor(datalog_5$Tank)
datalog_5$value<-as.character(datalog_5$value)
datalog_5 <- datalog_5 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_5) - 1))
datalog_5
```

```{r}
datalog_6<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-16_datalog.csv", strip.white=T)
datalog_6$date <- as.POSIXct(datalog_6$date, format = "%m/%d/%Y %H:%M")
datalog_6$date <- format(datalog_6$date, "%Y-%m-%d %H:%M:%S")
datalog_6$date <- as.POSIXct(datalog_6$date, format = "%Y-%m-%d %H:%M:%S")
datalog_6<- plyr::rename(datalog_6, c("date"="Date_Time"))
datalog_6 <- datalog_6 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_6$Treatment <- ifelse(datalog_6$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_6<- plyr::rename(datalog_6, c("name"="Tank"))
datalog_6$Treatment<-as.factor(datalog_6$Treatment)
datalog_6$Tank<-as.factor(datalog_6$Tank)
datalog_6$value<-as.character(datalog_6$value)
datalog_6 <- datalog_6 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_6) - 1))
datalog_6
```

```{r}
datalog_7<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-17_datalog.csv", strip.white=T)
datalog_7$date <- as.POSIXct(datalog_7$date, format = "%m/%d/%Y %H:%M")
datalog_7$date <- format(datalog_7$date, "%Y-%m-%d %H:%M:%S")
datalog_7$date <- as.POSIXct(datalog_7$date, format = "%Y-%m-%d %H:%M:%S")
datalog_7<- plyr::rename(datalog_7, c("date"="Date_Time"))
datalog_7 <- datalog_7 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_7$Treatment <- ifelse(datalog_7$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_7<- plyr::rename(datalog_7, c("name"="Tank"))
datalog_7$Treatment<-as.factor(datalog_7$Treatment)
datalog_7$Tank<-as.factor(datalog_7$Tank)
datalog_7$value<-as.character(datalog_7$value)
datalog_7 <- datalog_7 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_7) - 1))
datalog_7
```

```{r}
datalog_8<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-18_datalog.csv", strip.white=T)
datalog_8$date <- as.POSIXct(datalog_8$date, format = "%m/%d/%Y %H:%M")
datalog_8$date <- format(datalog_8$date, "%Y-%m-%d %H:%M:%S")
datalog_8$date <- as.POSIXct(datalog_8$date, format = "%Y-%m-%d %H:%M:%S")
datalog_8<- plyr::rename(datalog_8, c("date"="Date_Time"))
datalog_8 <- datalog_8 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_8$Treatment <- ifelse(datalog_8$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_8<- plyr::rename(datalog_8, c("name"="Tank"))
datalog_8$Treatment<-as.factor(datalog_8$Treatment)
datalog_8$Tank<-as.factor(datalog_8$Tank)
datalog_8$value<-as.character(datalog_8$value)
datalog_8 <- datalog_8 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_8) - 1))
datalog_8
```

```{r}
datalog_9<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-19_datalog.csv", strip.white=T)
datalog_9$date <- as.POSIXct(datalog_9$date, format = "%m/%d/%Y %H:%M")
datalog_9$date <- format(datalog_9$date, "%Y-%m-%d %H:%M:%S")
datalog_9$date <- as.POSIXct(datalog_9$date, format = "%Y-%m-%d %H:%M:%S")
datalog_9<- plyr::rename(datalog_9, c("date"="Date_Time"))
datalog_9 <- datalog_9 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_9$Treatment <- ifelse(datalog_9$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_9<- plyr::rename(datalog_9, c("name"="Tank"))
datalog_9$Treatment<-as.factor(datalog_9$Treatment)
datalog_9$Tank<-as.factor(datalog_9$Tank)
datalog_9$value<-as.character(datalog_9$value)
datalog_9 <- datalog_9 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_9) - 1))
datalog_9
```


```{r}
datalog_10<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-20_datalog.csv", strip.white=T)
datalog_10$date <- as.POSIXct(datalog_10$date, format = "%m/%d/%Y %H:%M")
datalog_10$date <- format(datalog_10$date, "%Y-%m-%d %H:%M:%S")
datalog_10$date <- as.POSIXct(datalog_10$date, format = "%Y-%m-%d %H:%M:%S")
datalog_10<- plyr::rename(datalog_10, c("date"="Date_Time"))
datalog_10 <- datalog_10 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_10$Treatment <- ifelse(datalog_10$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_10<- plyr::rename(datalog_10, c("name"="Tank"))
datalog_10$Treatment<-as.factor(datalog_10$Treatment)
datalog_10$Tank<-as.factor(datalog_10$Tank)
datalog_10$value<-as.character(datalog_10$value)
datalog_10 <- datalog_10 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_10) - 1))
datalog_10
```

```{r}
datalog_11<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-21_datalog.csv", strip.white=T)
datalog_11$date <- as.POSIXct(datalog_11$date, format = "%m/%d/%Y %H:%M")
datalog_11$date <- format(datalog_11$date, "%Y-%m-%d %H:%M:%S")
datalog_11$date <- as.POSIXct(datalog_11$date, format = "%Y-%m-%d %H:%M:%S")
datalog_11<- plyr::rename(datalog_11, c("date"="Date_Time"))
datalog_11 <- datalog_11 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_11$Treatment <- ifelse(datalog_11$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_11<- plyr::rename(datalog_11, c("name"="Tank"))
datalog_11$Treatment<-as.factor(datalog_11$Treatment)
datalog_11$Tank<-as.factor(datalog_11$Tank)
datalog_11$value<-as.character(datalog_11$value)
datalog_11 <- datalog_11 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_11) - 1))
datalog_11
```
```{r}
datalog_12<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-22_datalog.csv", strip.white=T)
datalog_12$date <- as.POSIXct(datalog_12$date, format = "%m/%d/%Y %H:%M")
datalog_12$date <- format(datalog_12$date, "%Y-%m-%d %H:%M:%S")
datalog_12$date <- as.POSIXct(datalog_12$date, format = "%Y-%m-%d %H:%M:%S")
datalog_12<- plyr::rename(datalog_12, c("date"="Date_Time"))
datalog_12 <- datalog_12 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_12$Treatment <- ifelse(datalog_12$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_12<- plyr::rename(datalog_12, c("name"="Tank"))
datalog_12$Treatment<-as.factor(datalog_12$Treatment)
datalog_12$Tank<-as.factor(datalog_12$Tank)
datalog_12$value<-as.character(datalog_12$value)
datalog_12 <- datalog_12 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_12) - 1))
datalog_12
```

```{r}
datalog_13<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-23_datalog.csv", strip.white=T)
datalog_13$date <- as.POSIXct(datalog_13$date, format = "%m/%d/%Y %H:%M")
datalog_13$date <- format(datalog_13$date, "%Y-%m-%d %H:%M:%S")
datalog_13$date <- as.POSIXct(datalog_13$date, format = "%Y-%m-%d %H:%M:%S")
datalog_13<- plyr::rename(datalog_13, c("date"="Date_Time"))
datalog_13 <- datalog_13 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_13$Treatment <- ifelse(datalog_13$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_13<- plyr::rename(datalog_13, c("name"="Tank"))
datalog_13$Treatment<-as.factor(datalog_13$Treatment)
datalog_13$Tank<-as.factor(datalog_13$Tank)
datalog_13$value<-as.character(datalog_13$value)
datalog_13 <- datalog_13 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_13) - 1))
datalog_13
```

```{r}
datalog_14<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-24_datalog.csv", strip.white=T)
datalog_14$date <- as.POSIXct(datalog_14$date, format = "%m/%d/%Y %H:%M")
datalog_14$date <- format(datalog_14$date, "%Y-%m-%d %H:%M:%S")
datalog_14$date <- as.POSIXct(datalog_14$date, format = "%Y-%m-%d %H:%M:%S")
datalog_14<- plyr::rename(datalog_14, c("date"="Date_Time"))
datalog_14 <- datalog_14 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_14$Treatment <- ifelse(datalog_14$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_14<- plyr::rename(datalog_14, c("name"="Tank"))
datalog_14$Treatment<-as.factor(datalog_14$Treatment)
datalog_14$Tank<-as.factor(datalog_14$Tank)
datalog_14$value<-as.character(datalog_14$value)
datalog_14 <- datalog_14 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_14) - 1))
datalog_14
```

```{r}
datalog_15<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-25_datalog.csv", strip.white=T)
datalog_15$date <- as.POSIXct(datalog_15$date, format = "%m/%d/%Y %H:%M")
datalog_15$date <- format(datalog_15$date, "%Y-%m-%d %H:%M:%S")
datalog_15$date <- as.POSIXct(datalog_15$date, format = "%Y-%m-%d %H:%M:%S")
datalog_15<- plyr::rename(datalog_15, c("date"="Date_Time"))
datalog_15 <- datalog_15 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_15$Treatment <- ifelse(datalog_15$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_15<- plyr::rename(datalog_15, c("name"="Tank"))
datalog_15$Treatment<-as.factor(datalog_15$Treatment)
datalog_15$Tank<-as.factor(datalog_15$Tank)
datalog_15$value<-as.character(datalog_15$value)
datalog_15 <- datalog_15 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_15) - 1))
datalog_15
```

```{r}
datalog_16<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-26_datalog.csv", strip.white=T)
datalog_16$date <- as.POSIXct(datalog_16$date, format = "%m/%d/%Y %H:%M")
datalog_16$date <- format(datalog_16$date, "%Y-%m-%d %H:%M:%S")
datalog_16$date <- as.POSIXct(datalog_16$date, format = "%Y-%m-%d %H:%M:%S")
datalog_16<- plyr::rename(datalog_16, c("date"="Date_Time"))
datalog_16 <- datalog_16 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_16$Treatment <- ifelse(datalog_16$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_16<- plyr::rename(datalog_16, c("name"="Tank"))
datalog_16$Treatment<-as.factor(datalog_16$Treatment)
datalog_16$Tank<-as.factor(datalog_16$Tank)
datalog_16$value<-as.character(datalog_16$value)
datalog_16 <- datalog_16 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_16) - 1))
datalog_16
```

```{r}
datalog_17<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-27_datalog.csv", strip.white=T)
datalog_17$date <- as.POSIXct(datalog_17$date, format = "%m/%d/%Y %H:%M")
datalog_17$date <- format(datalog_17$date, "%Y-%m-%d %H:%M:%S")
datalog_17$date <- as.POSIXct(datalog_17$date, format = "%Y-%m-%d %H:%M:%S")
datalog_17<- plyr::rename(datalog_17, c("date"="Date_Time"))
datalog_17 <- datalog_17 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_17$Treatment <- ifelse(datalog_17$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_17<- plyr::rename(datalog_17, c("name"="Tank"))
datalog_17$Treatment<-as.factor(datalog_17$Treatment)
datalog_17$Tank<-as.factor(datalog_17$Tank)
datalog_17$value<-as.character(datalog_17$value)
datalog_17 <- datalog_17 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_17) - 1))
datalog_17
```

```{r}
datalog_18<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-28_datalog.csv", strip.white=T)
datalog_18$date <- as.POSIXct(datalog_18$date, format = "%m/%d/%Y %H:%M")
datalog_18$date <- format(datalog_18$date, "%Y-%m-%d %H:%M:%S")
datalog_18$date <- as.POSIXct(datalog_18$date, format = "%Y-%m-%d %H:%M:%S")
datalog_18<- plyr::rename(datalog_18, c("date"="Date_Time"))
datalog_18 <- datalog_18 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_18$Treatment <- ifelse(datalog_18$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_18<- plyr::rename(datalog_18, c("name"="Tank"))
datalog_18$Treatment<-as.factor(datalog_18$Treatment)
datalog_18$Tank<-as.factor(datalog_18$Tank)
datalog_18$value<-as.character(datalog_18$value)
datalog_18 <- datalog_18 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_18) - 1))
datalog_18
```

```{r}
datalog_19<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-29_datalog.csv", strip.white=T)
datalog_19$date <- as.POSIXct(datalog_19$date, format = "%m/%d/%Y %H:%M")
datalog_19$date <- format(datalog_19$date, "%Y-%m-%d %H:%M:%S")
datalog_19$date <- as.POSIXct(datalog_19$date, format = "%Y-%m-%d %H:%M:%S")
datalog_19<- plyr::rename(datalog_19, c("date"="Date_Time"))
datalog_19 <- datalog_19 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_19$Treatment <- ifelse(datalog_19$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_19<- plyr::rename(datalog_19, c("name"="Tank"))
datalog_19$Treatment<-as.factor(datalog_19$Treatment)
datalog_19$Tank<-as.factor(datalog_19$Tank)
datalog_19$value<-as.character(datalog_19$value)
datalog_19 <- datalog_19 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_19) - 1))
datalog_19
```


```{r}
datalog_30<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-30_datalog.csv", strip.white=T)
datalog_30$date <- as.POSIXct(datalog_30$date, format = "%m/%d/%Y %H:%M")
datalog_30$date <- format(datalog_30$date, "%Y-%m-%d %H:%M:%S")
datalog_30$date <- as.POSIXct(datalog_30$date, format = "%Y-%m-%d %H:%M:%S")
datalog_30<- plyr::rename(datalog_30, c("date"="Date_Time"))
datalog_30 <- datalog_30 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_30$Treatment <- ifelse(datalog_30$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_30<- plyr::rename(datalog_30, c("name"="Tank"))
datalog_30$Treatment<-as.factor(datalog_30$Treatment)
datalog_30$Tank<-as.factor(datalog_30$Tank)
datalog_30$value<-as.character(datalog_30$value)
datalog_30 <- datalog_30 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_30) - 1))
datalog_30
```

```{r}
datalog_31<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-31_datalog.csv", strip.white=T)
datalog_31$date <- as.POSIXct(datalog_31$date, format = "%m/%d/%Y %H:%M")
datalog_31$date <- format(datalog_31$date, "%Y-%m-%d %H:%M:%S")
datalog_31$date <- as.POSIXct(datalog_31$date, format = "%Y-%m-%d %H:%M:%S")
datalog_31<- plyr::rename(datalog_31, c("date"="Date_Time"))
datalog_31 <- datalog_31 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_31$Treatment <- ifelse(datalog_31$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_31<- plyr::rename(datalog_31, c("name"="Tank"))
datalog_31$Treatment<-as.factor(datalog_31$Treatment)
datalog_31$Tank<-as.factor(datalog_31$Tank)
datalog_31$value<-as.character(datalog_31$value)
datalog_31 <- datalog_31 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_31) - 1))
datalog_31
```

```{r}
datalog_32<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-01_datalog.csv", strip.white=T)
datalog_32$date <- as.POSIXct(datalog_32$date, format = "%m/%d/%Y %H:%M")
datalog_32$date <- format(datalog_32$date, "%Y-%m-%d %H:%M:%S")
datalog_32$date <- as.POSIXct(datalog_32$date, format = "%Y-%m-%d %H:%M:%S")
datalog_32<- plyr::rename(datalog_32, c("date"="Date_Time"))
datalog_32 <- datalog_32 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_32$Treatment <- ifelse(datalog_32$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_32<- plyr::rename(datalog_32, c("name"="Tank"))
datalog_32$Treatment<-as.factor(datalog_32$Treatment)
datalog_32$Tank<-as.factor(datalog_32$Tank)
datalog_32$value<-as.character(datalog_32$value)
datalog_32 <- datalog_32 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_32) - 1))
datalog_32
```

```{r}
datalog_33<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-02_datalog.csv", strip.white=T)
datalog_33$date <- as.POSIXct(datalog_33$date, format = "%m/%d/%Y %H:%M")
datalog_33$date <- format(datalog_33$date, "%Y-%m-%d %H:%M:%S")
datalog_33$date <- as.POSIXct(datalog_33$date, format = "%Y-%m-%d %H:%M:%S")
datalog_33<- plyr::rename(datalog_33, c("date"="Date_Time"))
datalog_33 <- datalog_33 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_33$Treatment <- ifelse(datalog_33$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_33<- plyr::rename(datalog_33, c("name"="Tank"))
datalog_33$Treatment<-as.factor(datalog_33$Treatment)
datalog_33$Tank<-as.factor(datalog_33$Tank)
datalog_33$value<-as.character(datalog_33$value)
datalog_33 <- datalog_33 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_33) - 1))
datalog_33
```

```{r}
datalog_34<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-03_datalog.csv", strip.white=T)
datalog_34$date <- as.POSIXct(datalog_34$date, format = "%m/%d/%Y %H:%M")
datalog_34$date <- format(datalog_34$date, "%Y-%m-%d %H:%M:%S")
datalog_34$date <- as.POSIXct(datalog_34$date, format = "%Y-%m-%d %H:%M:%S")
datalog_34<- plyr::rename(datalog_34, c("date"="Date_Time"))
datalog_34 <- datalog_34 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_34$Treatment <- ifelse(datalog_34$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_34<- plyr::rename(datalog_34, c("name"="Tank"))
datalog_34$Treatment<-as.factor(datalog_34$Treatment)
datalog_34$Tank<-as.factor(datalog_34$Tank)
datalog_34$value<-as.character(datalog_34$value)
datalog_34 <- datalog_34 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_34) - 1))
datalog_34
```

```{r}
datalog_35<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-04_datalog.csv", strip.white=T)
datalog_35$date <- as.POSIXct(datalog_35$date, format = "%m/%d/%Y %H:%M")
datalog_35$date <- format(datalog_35$date, "%Y-%m-%d %H:%M:%S")
datalog_35$date <- as.POSIXct(datalog_35$date, format = "%Y-%m-%d %H:%M:%S")
datalog_35<- plyr::rename(datalog_35, c("date"="Date_Time"))
datalog_35 <- datalog_35 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_35$Treatment <- ifelse(datalog_35$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_35<- plyr::rename(datalog_35, c("name"="Tank"))
datalog_35$Treatment<-as.factor(datalog_35$Treatment)
datalog_35$Tank<-as.factor(datalog_35$Tank)
datalog_35$value<-as.character(datalog_35$value)
datalog_35 <- datalog_35 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_35) - 1))
datalog_35
```

```{r}
datalog_36<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-05_datalog.csv", strip.white=T)
datalog_36$date <- as.POSIXct(datalog_36$date, format = "%m/%d/%Y %H:%M")
datalog_36$date <- format(datalog_36$date, "%Y-%m-%d %H:%M:%S")
datalog_36$date <- as.POSIXct(datalog_36$date, format = "%Y-%m-%d %H:%M:%S")
datalog_36<- plyr::rename(datalog_36, c("date"="Date_Time"))
datalog_36 <- datalog_36 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_36$Treatment <- ifelse(datalog_36$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_36<- plyr::rename(datalog_36, c("name"="Tank"))
datalog_36$Treatment<-as.factor(datalog_36$Treatment)
datalog_36$Tank<-as.factor(datalog_36$Tank)
datalog_36$value<-as.character(datalog_36$value)
datalog_36 <- datalog_36 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_36) - 1))
datalog_36
```

```{r}
datalog_37<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-06_datalog.csv", strip.white=T)
datalog_37$date <- as.POSIXct(datalog_37$date, format = "%m/%d/%Y %H:%M")
datalog_37$date <- format(datalog_37$date, "%Y-%m-%d %H:%M:%S")
datalog_37$date <- as.POSIXct(datalog_37$date, format = "%Y-%m-%d %H:%M:%S")
datalog_37<- plyr::rename(datalog_37, c("date"="Date_Time"))
datalog_37 <- datalog_37 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_37$Treatment <- ifelse(datalog_37$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_37<- plyr::rename(datalog_37, c("name"="Tank"))
datalog_37$Treatment<-as.factor(datalog_37$Treatment)
datalog_37$Tank<-as.factor(datalog_37$Tank)
datalog_37$value<-as.character(datalog_37$value)
datalog_37 <- datalog_37 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_37) - 1))
datalog_37
```

```{r}
datalog_38<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-07_datalog.csv", strip.white=T)
datalog_38$date <- as.POSIXct(datalog_38$date, format = "%m/%d/%Y %H:%M")
datalog_38$date <- format(datalog_38$date, "%Y-%m-%d %H:%M:%S")
datalog_38$date <- as.POSIXct(datalog_38$date, format = "%Y-%m-%d %H:%M:%S")
datalog_38<- plyr::rename(datalog_38, c("date"="Date_Time"))
datalog_38 <- datalog_38 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_38$Treatment <- ifelse(datalog_38$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_38<- plyr::rename(datalog_38, c("name"="Tank"))
datalog_38$Treatment<-as.factor(datalog_38$Treatment)
datalog_38$Tank<-as.factor(datalog_38$Tank)
datalog_38$value<-as.character(datalog_38$value)
datalog_38 <- datalog_38 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_38) - 1))
datalog_38
```

```{r}
datalog_39<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-08_datalog.csv", strip.white=T)
datalog_39$date <- as.POSIXct(datalog_39$date, format = "%m/%d/%Y %H:%M")
datalog_39$date <- format(datalog_39$date, "%Y-%m-%d %H:%M:%S")
datalog_39$date <- as.POSIXct(datalog_39$date, format = "%Y-%m-%d %H:%M:%S")
datalog_39<- plyr::rename(datalog_39, c("date"="Date_Time"))
datalog_39 <- datalog_39 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_39$Treatment <- ifelse(datalog_39$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_39<- plyr::rename(datalog_39, c("name"="Tank"))
datalog_39$Treatment<-as.factor(datalog_39$Treatment)
datalog_39$Tank<-as.factor(datalog_39$Tank)
datalog_39$value<-as.character(datalog_39$value)
datalog_39 <- datalog_39 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_39) - 1))
datalog_39
```

```{r}
datalog_40<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-09_datalog.csv", strip.white=T)
datalog_40$date <- as.POSIXct(datalog_40$date, format = "%m/%d/%Y %H:%M")
datalog_40$date <- format(datalog_40$date, "%Y-%m-%d %H:%M:%S")
datalog_40$date <- as.POSIXct(datalog_40$date, format = "%Y-%m-%d %H:%M:%S")
datalog_40<- plyr::rename(datalog_40, c("date"="Date_Time"))
datalog_40 <- datalog_40 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_40$Treatment <- ifelse(datalog_40$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_40<- plyr::rename(datalog_40, c("name"="Tank"))
datalog_40$Treatment<-as.factor(datalog_40$Treatment)
datalog_40$Tank<-as.factor(datalog_40$Tank)
datalog_40$value<-as.character(datalog_40$value)
datalog_40 <- datalog_40 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_40) - 1))
datalog_40
```

```{r}
datalog_41<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-10_datalog.csv", strip.white=T)
datalog_41$date <- as.POSIXct(datalog_41$date, format = "%m/%d/%Y %H:%M")
datalog_41$date <- format(datalog_41$date, "%Y-%m-%d %H:%M:%S")
datalog_41$date <- as.POSIXct(datalog_41$date, format = "%Y-%m-%d %H:%M:%S")
datalog_41<- plyr::rename(datalog_41, c("date"="Date_Time"))
datalog_41 <- datalog_41 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_41$Treatment <- ifelse(datalog_41$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_41<- plyr::rename(datalog_41, c("name"="Tank"))
datalog_41$Treatment<-as.factor(datalog_41$Treatment)
datalog_41$Tank<-as.factor(datalog_41$Tank)
datalog_41$value<-as.character(datalog_41$value)
datalog_41 <- datalog_41 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_41) - 1))
datalog_41
```

```{r}
datalog_42<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-11_datalog.csv", strip.white=T)
datalog_42$date <- as.POSIXct(datalog_42$date, format = "%m/%d/%Y %H:%M")
datalog_42$date <- format(datalog_42$date, "%Y-%m-%d %H:%M:%S")
datalog_42$date <- as.POSIXct(datalog_42$date, format = "%Y-%m-%d %H:%M:%S")
datalog_42<- plyr::rename(datalog_42, c("date"="Date_Time"))
datalog_42 <- datalog_42 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_42$Treatment <- ifelse(datalog_42$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_42<- plyr::rename(datalog_42, c("name"="Tank"))
datalog_42$Treatment<-as.factor(datalog_42$Treatment)
datalog_42$Tank<-as.factor(datalog_42$Tank)
datalog_42$value<-as.character(datalog_42$value)
datalog_42 <- datalog_42 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_42) - 1))
datalog_42
```

```{r}
datalog_43<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-12_datalog.csv", strip.white=T)
datalog_43$date <- as.POSIXct(datalog_43$date, format = "%m/%d/%Y %H:%M")
datalog_43$date <- format(datalog_43$date, "%Y-%m-%d %H:%M:%S")
datalog_43$date <- as.POSIXct(datalog_43$date, format = "%Y-%m-%d %H:%M:%S")
datalog_43<- plyr::rename(datalog_43, c("date"="Date_Time"))
datalog_43 <- datalog_43 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_43$Treatment <- ifelse(datalog_43$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_43<- plyr::rename(datalog_43, c("name"="Tank"))
datalog_43$Treatment<-as.factor(datalog_43$Treatment)
datalog_43$Tank<-as.factor(datalog_43$Tank)
datalog_43$value<-as.character(datalog_43$value)
datalog_43 <- datalog_43 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_43) - 1))
datalog_43
```

```{r}
datalog_44<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-13_datalog.csv", strip.white=T)
datalog_44$date <- as.POSIXct(datalog_44$date, format = "%m/%d/%Y %H:%M")
datalog_44$date <- format(datalog_44$date, "%Y-%m-%d %H:%M:%S")
datalog_44$date <- as.POSIXct(datalog_44$date, format = "%Y-%m-%d %H:%M:%S")
datalog_44<- plyr::rename(datalog_44, c("date"="Date_Time"))
datalog_44 <- datalog_44 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_44$Treatment <- ifelse(datalog_44$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_44<- plyr::rename(datalog_44, c("name"="Tank"))
datalog_44$Treatment<-as.factor(datalog_44$Treatment)
datalog_44$Tank<-as.factor(datalog_44$Tank)
datalog_44$value<-as.character(datalog_44$value)
datalog_44 <- datalog_44 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_44) - 1))
datalog_44
```

```{r}
datalog_45<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-14_datalog.csv", strip.white=T)
datalog_45$date <- as.POSIXct(datalog_45$date, format = "%m/%d/%Y %H:%M")
datalog_45$date <- format(datalog_45$date, "%Y-%m-%d %H:%M:%S")
datalog_45$date <- as.POSIXct(datalog_45$date, format = "%Y-%m-%d %H:%M:%S")
datalog_45<- plyr::rename(datalog_45, c("date"="Date_Time"))
datalog_45 <- datalog_45 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_45$Treatment <- ifelse(datalog_45$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_45<- plyr::rename(datalog_45, c("name"="Tank"))
datalog_45$Treatment<-as.factor(datalog_45$Treatment)
datalog_45$Tank<-as.factor(datalog_45$Tank)
datalog_45$value<-as.character(datalog_45$value)
datalog_45 <- datalog_45 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_45) - 1))
datalog_45
```

```{r}
datalog_46<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-15_datalog.csv", strip.white=T)
datalog_46$date <- as.POSIXct(datalog_46$date, format = "%m/%d/%Y %H:%M")
datalog_46$date <- format(datalog_46$date, "%Y-%m-%d %H:%M:%S")
datalog_46$date <- as.POSIXct(datalog_46$date, format = "%Y-%m-%d %H:%M:%S")
datalog_46<- plyr::rename(datalog_46, c("date"="Date_Time"))
datalog_46 <- datalog_46 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_46$Treatment <- ifelse(datalog_46$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_46<- plyr::rename(datalog_46, c("name"="Tank"))
datalog_46$Treatment<-as.factor(datalog_46$Treatment)
datalog_46$Tank<-as.factor(datalog_46$Tank)
datalog_46$value<-as.character(datalog_46$value)
datalog_46 <- datalog_46 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_46) - 1))
datalog_46
```

```{r}
datalog_47<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-16_datalog.csv", strip.white=T)
datalog_47$date <- as.POSIXct(datalog_47$date, format = "%m/%d/%Y %H:%M")
datalog_47$date <- format(datalog_47$date, "%Y-%m-%d %H:%M:%S")
datalog_47$date <- as.POSIXct(datalog_47$date, format = "%Y-%m-%d %H:%M:%S")
datalog_47<- plyr::rename(datalog_47, c("date"="Date_Time"))
datalog_47 <- datalog_47 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_47$Treatment <- ifelse(datalog_47$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_47<- plyr::rename(datalog_47, c("name"="Tank"))
datalog_47$Treatment<-as.factor(datalog_47$Treatment)
datalog_47$Tank<-as.factor(datalog_47$Tank)
datalog_47$value<-as.character(datalog_47$value)
datalog_47 <- datalog_47 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_47) - 1))
datalog_47
```

```{r}
datalog_48<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-17_datalog.csv", strip.white=T)
datalog_48$date <- as.POSIXct(datalog_48$date, format = "%m/%d/%Y %H:%M")
datalog_48$date <- format(datalog_48$date, "%Y-%m-%d %H:%M:%S")
datalog_48$date <- as.POSIXct(datalog_48$date, format = "%Y-%m-%d %H:%M:%S")
datalog_48<- plyr::rename(datalog_48, c("date"="Date_Time"))
datalog_48 <- datalog_48 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_48$Treatment <- ifelse(datalog_48$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_48<- plyr::rename(datalog_48, c("name"="Tank"))
datalog_48$Treatment<-as.factor(datalog_48$Treatment)
datalog_48$Tank<-as.factor(datalog_48$Tank)
datalog_48$value<-as.character(datalog_48$value)
datalog_48 <- datalog_48 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_48) - 1))
datalog_48
```

```{r}
datalog_49<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-18_datalog.csv", strip.white=T)
datalog_49$date <- as.POSIXct(datalog_49$date, format = "%m/%d/%Y %H:%M")
datalog_49$date <- format(datalog_49$date, "%Y-%m-%d %H:%M:%S")
datalog_49$date <- as.POSIXct(datalog_49$date, format = "%Y-%m-%d %H:%M:%S")
datalog_49<- plyr::rename(datalog_49, c("date"="Date_Time"))
datalog_49 <- datalog_49 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_49$Treatment <- ifelse(datalog_49$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_49<- plyr::rename(datalog_49, c("name"="Tank"))
datalog_49$Treatment<-as.factor(datalog_49$Treatment)
datalog_49$Tank<-as.factor(datalog_49$Tank)
datalog_49$value<-as.character(datalog_49$value)
datalog_49 <- datalog_49 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_49) - 1))
datalog_49
```

```{r}
datalog_50<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-19_datalog.csv", strip.white=T)
datalog_50$date <- as.POSIXct(datalog_50$date, format = "%m/%d/%Y %H:%M")
datalog_50$date <- format(datalog_50$date, "%Y-%m-%d %H:%M:%S")
datalog_50$date <- as.POSIXct(datalog_50$date, format = "%Y-%m-%d %H:%M:%S")
datalog_50<- plyr::rename(datalog_50, c("date"="Date_Time"))
datalog_50 <- datalog_50 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_50$Treatment <- ifelse(datalog_50$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_50<- plyr::rename(datalog_50, c("name"="Tank"))
datalog_50$Treatment<-as.factor(datalog_50$Treatment)
datalog_50$Tank<-as.factor(datalog_50$Tank)
datalog_50$value<-as.character(datalog_50$value)
datalog_50 <- datalog_50 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_50) - 1))
datalog_50
```

```{r}
datalog_51<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-20_datalog.csv", strip.white=T)
datalog_51$date <- as.POSIXct(datalog_51$date, format = "%m/%d/%Y %H:%M")
datalog_51$date <- format(datalog_51$date, "%Y-%m-%d %H:%M:%S")
datalog_51$date <- as.POSIXct(datalog_51$date, format = "%Y-%m-%d %H:%M:%S")
datalog_51<- plyr::rename(datalog_51, c("date"="Date_Time"))
datalog_51 <- datalog_51 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_51$Treatment <- ifelse(datalog_51$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_51<- plyr::rename(datalog_51, c("name"="Tank"))
datalog_51$Treatment<-as.factor(datalog_51$Treatment)
datalog_51$Tank<-as.factor(datalog_51$Tank)
datalog_51$value<-as.character(datalog_51$value)
datalog_51 <- datalog_51 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_51) - 1))
datalog_51
```

```{r}
datalog_52<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-21_datalog.csv", strip.white=T)
datalog_52$date <- as.POSIXct(datalog_52$date, format = "%m/%d/%Y %H:%M")
datalog_52$date <- format(datalog_52$date, "%Y-%m-%d %H:%M:%S")
datalog_52$date <- as.POSIXct(datalog_52$date, format = "%Y-%m-%d %H:%M:%S")
datalog_52<- plyr::rename(datalog_52, c("date"="Date_Time"))
datalog_52 <- datalog_52 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_52$Treatment <- ifelse(datalog_52$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_52<- plyr::rename(datalog_52, c("name"="Tank"))
datalog_52$Treatment<-as.factor(datalog_52$Treatment)
datalog_52$Tank<-as.factor(datalog_52$Tank)
datalog_52$value<-as.character(datalog_52$value)
datalog_52 <- datalog_52 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_52) - 1))
datalog_52
```

```{r}
datalog_53<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-22_datalog.csv", strip.white=T)
datalog_53$date <- as.POSIXct(datalog_53$date, format = "%m/%d/%Y %H:%M")
datalog_53$date <- format(datalog_53$date, "%Y-%m-%d %H:%M:%S")
datalog_53$date <- as.POSIXct(datalog_53$date, format = "%Y-%m-%d %H:%M:%S")
datalog_53<- plyr::rename(datalog_53, c("date"="Date_Time"))
datalog_53 <- datalog_53 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_53$Treatment <- ifelse(datalog_53$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_53<- plyr::rename(datalog_53, c("name"="Tank"))
datalog_53$Treatment<-as.factor(datalog_53$Treatment)
datalog_53$Tank<-as.factor(datalog_53$Tank)
datalog_53$value<-as.character(datalog_53$value)
datalog_53 <- datalog_53 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_53) - 1))
datalog_53
```

```{r}
datalog_54<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-23_datalog.csv", strip.white=T)
datalog_54$date <- as.POSIXct(datalog_54$date, format = "%m/%d/%Y %H:%M")
datalog_54$date <- format(datalog_54$date, "%Y-%m-%d %H:%M:%S")
datalog_54$date <- as.POSIXct(datalog_54$date, format = "%Y-%m-%d %H:%M:%S")
datalog_54<- plyr::rename(datalog_54, c("date"="Date_Time"))
datalog_54 <- datalog_54 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_54$Treatment <- ifelse(datalog_54$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_54<- plyr::rename(datalog_54, c("name"="Tank"))
datalog_54$Treatment<-as.factor(datalog_54$Treatment)
datalog_54$Tank<-as.factor(datalog_54$Tank)
datalog_54$value<-as.character(datalog_54$value)
datalog_54 <- datalog_54 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_54) - 1))
datalog_54
```

```{r}
datalog_55<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-23_datalog.csv", strip.white=T)
datalog_55$date <- as.POSIXct(datalog_55$date, format = "%m/%d/%Y %H:%M")
datalog_55$date <- format(datalog_55$date, "%Y-%m-%d %H:%M:%S")
datalog_55$date <- as.POSIXct(datalog_55$date, format = "%Y-%m-%d %H:%M:%S")
datalog_55<- plyr::rename(datalog_55, c("date"="Date_Time"))
datalog_55 <- datalog_55 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_55$Treatment <- ifelse(datalog_55$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_55<- plyr::rename(datalog_55, c("name"="Tank"))
datalog_55$Treatment<-as.factor(datalog_55$Treatment)
datalog_55$Tank<-as.factor(datalog_55$Tank)
datalog_55$value<-as.character(datalog_55$value)
datalog_55 <- datalog_55 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_55) - 1))
datalog_55
```

```{r}
datalog_56<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-06-24_datalog.csv", strip.white=T)
datalog_56$date <- as.POSIXct(datalog_56$date, format = "%m/%d/%Y %H:%M")
datalog_56$date <- format(datalog_56$date, "%Y-%m-%d %H:%M:%S")
datalog_56$date <- as.POSIXct(datalog_56$date, format = "%Y-%m-%d %H:%M:%S")
datalog_56<- plyr::rename(datalog_56, c("date"="Date_Time"))
datalog_56 <- datalog_56 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_56$Treatment <- ifelse(datalog_56$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_56<- plyr::rename(datalog_56, c("name"="Tank"))
datalog_56$Treatment<-as.factor(datalog_56$Treatment)
datalog_56$Tank<-as.factor(datalog_56$Tank)
datalog_56$value<-as.character(datalog_56$value)
datalog_56 <- datalog_56 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_56) - 1))
datalog_56
```

```{r}
datalog_57<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-08_datalog.csv", strip.white=T)
datalog_57$date <- as.POSIXct(datalog_57$date, format = "%m/%d/%Y %H:%M")
datalog_57$date <- format(datalog_57$date, "%Y-%m-%d %H:%M:%S")
datalog_57$date <- as.POSIXct(datalog_57$date, format = "%Y-%m-%d %H:%M:%S")
datalog_57<- plyr::rename(datalog_57, c("date"="Date_Time"))
datalog_57 <- datalog_57 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_57$Treatment <- ifelse(datalog_57$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_57<- plyr::rename(datalog_57, c("name"="Tank"))
datalog_57$Treatment<-as.factor(datalog_57$Treatment)
datalog_57$Tank<-as.factor(datalog_57$Tank)
datalog_57$value<-as.character(datalog_57$value)
datalog_57 <- datalog_57 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_57) - 1))
datalog_57
```

```{r}
datalog_58<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-09_datalog.csv", strip.white=T)
datalog_58$date <- as.POSIXct(datalog_58$date, format = "%m/%d/%Y %H:%M")
datalog_58$date <- format(datalog_58$date, "%Y-%m-%d %H:%M:%S")
datalog_58$date <- as.POSIXct(datalog_58$date, format = "%Y-%m-%d %H:%M:%S")
datalog_58<- plyr::rename(datalog_58, c("date"="Date_Time"))
datalog_58 <- datalog_58 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_58$Treatment <- ifelse(datalog_58$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_58<- plyr::rename(datalog_58, c("name"="Tank"))
datalog_58$Treatment<-as.factor(datalog_58$Treatment)
datalog_58$Tank<-as.factor(datalog_58$Tank)
datalog_58$value<-as.character(datalog_58$value)
datalog_58 <- datalog_58 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_58) - 1))
datalog_58
```

```{r}
datalog_59<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-10_datalog.csv", strip.white=T)
datalog_59$date <- as.POSIXct(datalog_59$date, format = "%m/%d/%Y %H:%M")
datalog_59$date <- format(datalog_59$date, "%Y-%m-%d %H:%M:%S")
datalog_59$date <- as.POSIXct(datalog_59$date, format = "%Y-%m-%d %H:%M:%S")
datalog_59<- plyr::rename(datalog_59, c("date"="Date_Time"))
datalog_59 <- datalog_59 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_59$Treatment <- ifelse(datalog_59$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_59<- plyr::rename(datalog_59, c("name"="Tank"))
datalog_59$Treatment<-as.factor(datalog_59$Treatment)
datalog_59$Tank<-as.factor(datalog_59$Tank)
datalog_59$value<-as.character(datalog_59$value)
datalog_59 <- datalog_59 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_59) - 1))
datalog_59
```

```{r}
datalog_60<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/2024-05-14_datalog.csv", strip.white=T)
datalog_60$date <- as.POSIXct(datalog_60$date, format = "%m/%d/%Y %H:%M")
datalog_60$date <- format(datalog_60$date, "%Y-%m-%d %H:%M:%S")
datalog_60$date <- as.POSIXct(datalog_60$date, format = "%Y-%m-%d %H:%M:%S")
datalog_60<- plyr::rename(datalog_60, c("date"="Date_Time"))
datalog_60 <- datalog_60 %>%
  mutate(date = as.Date(Date_Time),
         time = format(Date_Time, "%H:%M:%S"))
datalog_60$Treatment <- ifelse(datalog_60$name %in% c("TmpBas", "pHbase", "pH2Bas", "Tmpx3", "pHx3", "Tmpx5", "pHx5", "Tmpx7", "pHx7", "Tmpx9", "pHx9"), "Control", "Limu")
datalog_60<- plyr::rename(datalog_60, c("name"="Tank"))
datalog_60$Treatment<-as.factor(datalog_60$Treatment)
datalog_60$Tank<-as.factor(datalog_60$Tank)
datalog_60$value<-as.character(datalog_60$value)
datalog_60 <- datalog_60 %>%
  dplyr::select(1:2, Treatment, 3:(ncol(datalog_60) - 1))
datalog_60
```

```{r}
merged_datalog <- merge(datalog, datalog_2, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_3, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_4, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_5, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_6, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_7, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_8, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_9, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_10, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_11, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_12, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_13, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_14, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_15, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_16, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_17, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_18, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_19, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_30, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_31, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_32, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_33, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_34, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_35, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_36, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_37, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_38, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_39, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_40, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_41, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_42, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_43, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_44, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_45, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_46, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_47, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_48, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_49, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_50, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_51, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_52, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_53, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_54, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_55, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_56, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_57, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_58, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_59, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog <- merge(merged_datalog, datalog_60, by=c("software","hardware","Treatment","hostname","serial","timezone","Date_Time","Tank","type","value","date","time"), all=T)
merged_datalog
```

```{r}
library(tidyr)
merged_datalog <- merged_datalog %>%
  pivot_wider(names_from = type, values_from = value)
merged_datalog
```
```{r}
merged_datalog$hour <- as.POSIXlt(merged_datalog$Date_Time)$hour
merged_datalog$day <- day(as.POSIXlt(merged_datalog$Date_Time))
```
##Correct and clean the data

```{r}
spot_measure<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/pH and DO spot measurement log .csv", strip.white=T)
spot_measure$Date_Time<- as.POSIXct(paste(spot_measure$Date, spot_measure$Time), "%Y-%m-%d hh:mm:ss")
spot_measure
merged_datalog_2 <- merge(merged_datalog, spot_measure, by=c("Treatment","Date_Time","Tank"), all=T)
merged_datalog_filterd <- merged_datalog_2 %>%
  filter(!is.na(pH.x) & !is.na(pH.y))
merged_datalog_filterd$pH.x<-as.numeric(merged_datalog_filterd$pH.x)
merged_datalog_filterd$pH.y<-as.numeric(merged_datalog_filterd$pH.y)
merged_datalog_filterd
result <- merged_datalog_filterd %>%
  dplyr::group_by(Tank) %>%
  dplyr::mutate(Difference = pH.x - pH.y) %>%
  dplyr::summarise(Average_Difference = mean(Difference))
result
```

```{r}
correction_factors <- data.frame(
  Tank = c("pHx2", "pHx3", "pHx4","pHx5", "pHx6", "pHx7","pHx8", "pHx9", "pHx10", "TmpBas","Tmpx2", "Tmpx3", "Tmp4","Tmpx5", "Tmpx6", "Tmpx7","Tmpx8", "Tmpx9", "Tmpx10"),
  Correction_Factor = c(-0.081250,-0.2052500,-0.1731111,1.2821111,-0.1977778,-0.1408889,-0.2392222,-0.2188889,-0.3343333,0,0,0,0,0,0,0,0,0,0)
)
correction_factors
```

```{r}
merged_datalog_2 <- merge(merged_datalog_2, correction_factors, by = "Tank")
merged_datalog_2$pH.x<-as.numeric(merged_datalog_2$pH.x)
merged_datalog_2$Temp<-as.numeric(merged_datalog_2$Temp)
merged_datalog_2$Corrected_pH <- merged_datalog_2$pH.x + merged_datalog_2$Correction_Factor
merged_datalog_2
```

```{r}
merged_datalog_clean<- merged_datalog %>%
  dplyr::mutate(pH_clean=ifelse(pH < 7.50 | pH > 8.60 , NA,pH),
                Temperature_clean=ifelse(Temp < 23 | Temp > 28, NA,Temp))
merged_datalog_clean$pH_clean<-as.numeric(merged_datalog_clean$pH_clean)
merged_datalog_clean$Temperature_clean<-as.numeric(merged_datalog_clean$Temperature_clean)
#datalog_clean <- datalog_clean[complete.cases(datalog_clean$pH_clean), ]
merged_datalog_clean
```

##pH
```{r}
datalog_pH_sum_stats<-summarySE(merged_datalog_clean, measurevar='pH_clean', groupvars=c('Treatment','date', "hour", "Tank"), na.rm=TRUE, conf.interval = 0.95)
datalog_pH_sum_stats$hour<-as.factor(datalog_pH_sum_stats$hour)
pH.lme <- lme(pH_clean~Treatment*hour,random = ~1|Tank, data=datalog_pH_sum_stats, na.action=na.exclude)
Anova(pH.lme, type=3)
tukey3<- emmeans(pH.lme, list(pairwise ~ Treatment:hour), adjust = "tukey", simple= "Treatment")
tukey3
```


```{r}
datalog_pH_sum_hour<-summarySE(merged_datalog_clean, measurevar='pH_clean', groupvars=c('Treatment', "hour"), na.rm=TRUE, conf.interval = 0.95)
datalog_pH_sum_hour
```
####Figure- by hour
```{r}
pH_apex_timeseries_fig_hour<-ggplot(datalog_pH_sum_hour, aes(y=pH_clean, x=hour, color=Treatment, fill=Treatment))+
  geom_path(size=1)+
  geom_ribbon(aes(ymin=pH_clean-ci, ymax=pH_clean+ci), alpha=0.4, color=NA)+
  scale_y_continuous(expression(pH))+
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
pH_apex_timeseries_fig_hour
```


```{r}
datalog_pH_sum<-summarySE(merged_datalog_clean, measurevar='pH_clean', groupvars=c('Treatment','date', "hour"), na.rm=TRUE, conf.interval = 0.95)
datalog_pH_sum$hour <- sprintf("%02d:00:00", datalog_pH_sum$hour)
datalog_pH_sum$Date_Time <- as.POSIXct(paste(datalog_pH_sum$date, datalog_pH_sum$hour))
datalog_pH_sum
```
```{r}
datalog_pH_sum$Treatment <- factor(datalog_pH_sum$Treatment, levels=c("Limu","Control"))
pH_apex_timeseries_fig<-ggplot(datalog_pH_sum, aes(y=pH_clean, x=Date_Time, color=Treatment, fill=Treatment))+
  geom_point(size=1.25)+
  geom_path()+
  #geom_ribbon(aes(ymin=pH_clean-se, ymax=pH_clean+se), alpha=0.4, color=NA)+
  scale_x_datetime()+
  #facet_wrap(~Treatment)+
  scale_y_continuous(expression(pH))+
  scale_color_manual("Treatment", values=c("Control"= '#a6bddb', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#a6bddb', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
pH_apex_timeseries_fig
```
####Figure - all
```{r}
datalog_pH_sum$Treatment <- factor(datalog_pH_sum$Treatment, levels=c("Limu","Control"))
pH_apex_timeseries_fig2<-ggplot(datalog_pH_sum, aes(y=pH_clean, x=Date_Time, color=Treatment, fill=Treatment))+
  #geom_point(data=cc_merged, aes(y=pH,x=Date_Time, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path(size=1)+
  geom_ribbon(aes(ymin=pH_clean-se, ymax=pH_clean+se), alpha=0.4, color=NA)+
  scale_x_datetime()+
  scale_y_continuous(expression(pH), breaks=c(7.7,7.8,7.9,8.0,8.1,8.2,8.3,8.4))+
  scale_color_manual("Treatment", values=c("Control"= '#a6bddb', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#a6bddb', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
pH_apex_timeseries_fig2
```
```{r}
meanpH <- datalog_pH_sum %>%
  mutate(Period = case_when(
    Date_Time >= as.POSIXct("2024-05-01 00:00:00") & Date_Time <= as.POSIXct("2024-05-28 23:00:00") ~ "May 1 to May 28",
    Date_Time >= as.POSIXct("2024-05-29 00:00:00") & Date_Time <= as.POSIXct("2024-06-26 23:00:00") ~ "May 29 to June 26"
  )) %>%
  dplyr::group_by(Period, Treatment) %>%
  dplyr::summarise(Mean_pH = mean(pH_clean, na.rm = TRUE))
meanpH
```


```{r}
cc_merged_wai<-cc_merged%>% filter(Where != "HIMB")
cc_merged_wai$hour <- as.POSIXlt(cc_merged_wai$Date_Time)$hour
cc_merged_wai$hour <- sprintf("%02d:00:00", cc_merged_wai$hour)
cc_merged_wai$Date_Time2 <- as.POSIXct(paste(cc_merged_wai$Date, cc_merged_wai$hour))
cc_merged_wai
cc_merged_wai_sum<-summarySE(cc_merged_wai, measurevar="pH", groupvars=c("Treatment","Date_Time2"), na.rm=TRUE)
cc_merged_wai_sum
```
####Figure - WAIKALUA
```{r}
cc_merged_wai$Treatment <- factor(cc_merged_wai$Treatment, levels=c("Limu","Control"))
pH_wai<-ggplot(cc_merged_wai, aes(y=pH, x=Date_Time, color=Treatment, fill=Treatment))+
  #geom_path(size=1)+
  #geom_ribbon(aes(ymin=pH_clean-se, ymax=pH_clean+se), alpha=0.4, color=NA)+
  geom_point(data=cc_merged_wai, aes(y=pH,x=Date_Time, color=Time.of.day, fill=Treatment),position=position_jitterdodge(0.05),size=2,stroke=1, shape=21)+
  scale_x_datetime()+
  scale_y_continuous(expression(pH))+
  scale_color_manual("Treatment", values=c("Afternoon" = "grey60", "Evening" = "black","Limu"="#90C8AC","Control"= '#0A4D68'))+
  scale_fill_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
pH_wai
```

##Temperature
##HOBO
```{r}
control_1<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Temp_Control_1.csv", strip.white=T)
control_1<-rename(control_1, replace = c("Date.Time..GMT.10.00" = "Date_Time","Temp...C..LGR.S.N..20947188..SEN.S.N..20947188." = "Temperature"))
control_1$Date_Time <- format(as.POSIXct(control_1$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
control_1 <- control_1[, 2:3]
control_1$Treatment <- as.factor("Control")
control_1$Tank<-as.factor("1")
control_1
```

```{r}
control_3<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Temp_Control_3.csv", strip.white=T)
control_3<-rename(control_3, replace = c("Date.Time..GMT.10.00" = "Date_Time","Temp...C..LGR.S.N..20947197..SEN.S.N..20947197." = "Temperature"))
control_3$Date_Time <- format(as.POSIXct(control_3$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
control_3 <- control_3[, 2:3]
control_3$Treatment <- as.factor("Control")
control_3$Tank<-as.factor("3")
control_3
```
```{r}
control_5<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Temp_control_5.csv", strip.white=T)
control_5<-rename(control_5, replace = c("Date.Time..GMT.10.00" = "Date_Time","Temp...C..LGR.S.N..20947198..SEN.S.N..20947198..LBL..TTR_37." = "Temperature"))
control_5$Date_Time <- format(as.POSIXct(control_5$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
control_5 <- control_5[, 2:3]
control_5$Treatment <- as.factor("Control")
control_5$Tank<-as.factor("5")
control_5
```
```{r}
control_7<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Temp_control_7.csv", strip.white=T)
control_7<-rename(control_7, replace = c("Date.Time..GMT.10.00" = "Date_Time","Temp...C..LGR.S.N..20947184..SEN.S.N..20947184..LBL..TTR_33." = "Temperature"))
control_7$Date_Time <- format(as.POSIXct(control_7$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
control_7 <- control_7[, 2:3]
control_7$Treatment <- as.factor("Control")
control_7$Tank<-as.factor("7")
control_7
```
```{r}
control_9<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Temp_control_9.csv", strip.white=T)
control_9<-rename(control_9, replace = c("Date.Time..GMT.10.00" = "Date_Time","Temp...C..LGR.S.N..20947182..SEN.S.N..20947182." = "Temperature"))
control_9$Date_Time <- format(as.POSIXct(control_9$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
control_9 <- control_9[, 2:3]
control_9$Treatment <- as.factor("Control")
control_9$Tank<-as.factor("9")
control_9
```


```{r}
limu_4<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Temp_Limu_4.csv", strip.white=T)
limu_4<-rename(limu_4, replace = c("Date.Time..GMT.10.00" = "Date_Time","Temp...C..LGR.S.N..20947209..SEN.S.N..20947209." = "Temperature"))
limu_4$Date_Time <- format(as.POSIXct(limu_4$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
limu_4 <- limu_4[, 2:3]
limu_4$Treatment <- as.factor("Limu")
limu_4$Tank<-as.factor("4")
limu_4
```

```{r}
limu_6<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Temp_Limu_6.csv", strip.white=T)
limu_6<-rename(limu_6, replace = c("Date.Time..GMT.10.00" = "Date_Time","Temp...C..LGR.S.N..20947199..SEN.S.N..20947199..LBL..TTR_27." = "Temperature"))
limu_6$Date_Time <- format(as.POSIXct(limu_6$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
limu_6 <- limu_6[, 2:3]
limu_6$Treatment <- as.factor("Limu")
limu_6$Tank<-as.factor("6")
limu_6
```

```{r}
limu_8<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Temp_Limu_8.csv", strip.white=T)
limu_8<-rename(limu_8, replace = c("Date.Time..GMT.10.00" = "Date_Time","Temp...C..LGR.S.N..20947193..SEN.S.N..20947193." = "Temperature"))
limu_8$Date_Time <- format(as.POSIXct(limu_8$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
limu_8 <- limu_8[, 2:3]
limu_8$Treatment <- as.factor("Limu")
limu_8$Tank<-as.factor("8")
limu_8
```

```{r}
limu_10<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Temp_Limu_10.csv", strip.white=T)
limu_10<-rename(limu_10, replace = c("Date.Time..GMT.10.00" = "Date_Time","Temp...C..LGR.S.N..20947205..SEN.S.N..20947205." = "Temperature"))
limu_10$Date_Time <- format(as.POSIXct(limu_10$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
limu_10 <- limu_10[, 2:3]
limu_10$Treatment <- as.factor("Limu")
limu_10$Tank<-as.factor("10")
limu_10
```
```{r}
hobo_temp_all<- merge(control_1, control_3, by=c("Date_Time", "Temperature", "Treatment", "Tank"), all=T)
hobo_temp_all<- merge(hobo_temp_all, control_5, by=c("Date_Time", "Temperature", "Treatment", "Tank"), all=T)
hobo_temp_all<- merge(hobo_temp_all, control_7, by=c("Date_Time", "Temperature", "Treatment", "Tank"), all=T)
hobo_temp_all<- merge(hobo_temp_all, control_9, by=c("Date_Time", "Temperature", "Treatment", "Tank"), all=T)
hobo_temp_all<- merge(hobo_temp_all, limu_4, by=c("Date_Time", "Temperature", "Treatment", "Tank"), all=T)
hobo_temp_all<- merge(hobo_temp_all, limu_6, by=c("Date_Time", "Temperature", "Treatment", "Tank"), all=T)
hobo_temp_all<- merge(hobo_temp_all, limu_8, by=c("Date_Time", "Temperature", "Treatment", "Tank"), all=T)
hobo_temp_all<- merge(hobo_temp_all, limu_10, by=c("Date_Time", "Temperature", "Treatment", "Tank"), all=T)
hobo_temp_all
```

```{r}
hobo_temp_all_sum<-summarySE(hobo_temp_all, measurevar='Temperature', groupvars=c('Treatment','Date_Time'), na.rm=TRUE, conf.interval = 0.95)
hobo_temp_all_sum$Date_Time <- as.POSIXct(hobo_temp_all_sum$Date_Time)
hobo_temp_all_sum
```
```{r}
hobo_temp_all_sum2<- hobo_temp_all_sum %>%
  mutate(
    Date_Time = as.POSIXct(Date_Time, format = "%Y-%m-%d %H:%M:%S"),
    Hour = format(Date_Time, "%H") %>% as.numeric(),
    Time_of_day = case_when(
      Hour >= 11 & Hour <= 13 ~ "Afternoon",
      Hour >= 8 & Hour <= 10  ~ "Evening",
      TRUE ~ "Other"
    )
  )
hobo_temp_all_sum2<-summarySE(hobo_temp_all_sum2, measurevar='Temperature', groupvars=c('Treatment', "Time_of_day"), na.rm=TRUE, conf.interval = 0.95)
hobo_temp_all_sum2
```


####Figure - all
```{r}
hobo_temp_all_sum$Treatment <- factor(hobo_temp_all_sum$Treatment, levels=c("Limu","Control"))
hobo_temp_timeseries_fig<-ggplot(hobo_temp_all_sum, aes(y=Temperature, x=Date_Time, color=Treatment, fill=Treatment))+
  #geom_point(data=cc_merged, aes(y=pH,x=Date_Time, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path(size=1)+
  geom_ribbon(aes(ymin=Temperature-se, ymax=Temperature+se), alpha=0.4, color=NA)+
  scale_x_datetime()+
  scale_y_continuous(expression(Temperature~(degree~C)), breaks=c(24,25,26,27,28,29))+
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  geom_vline(xintercept = as.POSIXct("2024-05-28 12:00"), color = "black", linetype = "dashed", size = 1) +
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
hobo_temp_timeseries_fig
```
```{r}
hobo_temp_all_sum <- hobo_temp_all_sum %>%
  mutate(Period = case_when(
    Date_Time >= as.POSIXct("2024-05-01") & Date_Time <= as.POSIXct("2024-05-28") ~ "May 1 to May 28",
    Date_Time >= as.POSIXct("2024-05-29") & Date_Time <= as.POSIXct("2024-06-26") ~ "May 29 to June 26"
  ))
incursions_above_27 <- hobo_temp_all_sum %>%
  dplyr::filter(Temperature > 28) %>%
  group_by(Period) %>%
  dplyr::summarise(Count = n())
incursions_above_27
```

```{r}
hobo_temp_all$Date <- as.Date(hobo_temp_all$Date_Time)
hobo_temp_all_sum2<-  summarySE(hobo_temp_all, measurevar='Temperature', groupvars=c('Date', "Treatment", "Tank"), na.rm=TRUE, conf.interval = 0.95)
hobo_temp_all_sum2
```

```{r}
temp.lme <- lme(Temperature~Treatment*Date,random = ~1|Tank, data=hobo_temp_all_sum2, na.action=na.exclude)
Anova(temp.lme, type=3)
tukey3<- emmeans(pH.lme, list(pairwise ~ Treatment:hour), adjust = "tukey", simple= "Treatment")
tukey3
```

```{r}
hobo_temp_all_sum$Date <- as.Date(hobo_temp_all_sum$Date_Time)
hobo_temp_all_sum2<-  summarySE(hobo_temp_all_sum, measurevar='Temperature', na.rm=TRUE, conf.interval = 0.95)
hobo_temp_all_sum2
```

####Figure - all
```{r}
hobo_temp_all_sum2$Treatment <- factor(hobo_temp_all_sum2$Treatment, levels=c("Limu","Control"))
hobo_temp_timeseries_fig2<-ggplot(hobo_temp_all_sum2, aes(y=Temperature, x=Date, color=Treatment, fill=Treatment))+
  #geom_point(data=cc_merged, aes(y=pH,x=Date_Time, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path(size=1)+
  geom_ribbon(aes(ymin=Temperature-se, ymax=Temperature+se), alpha=0.4, color=NA)+
  #scale_x_datetime()+
  scale_y_continuous(expression(Temperature~(degree~C)), breaks=c(24,25,26,27,28,29))+
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  geom_vline(xintercept = as.Date("2024-05-28"), color = "black", linetype = "dashed", size = 1) +
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
hobo_temp_timeseries_fig2
```
```{r}
mean_temps <- hobo_temp_all_sum2 %>%
  mutate(Period = case_when(
    Date >= as.Date("2024-05-01") & Date <= as.Date("2024-05-28") ~ "May 1 to May 28",
    Date >= as.Date("2024-05-29") & Date <= as.Date("2024-06-26") ~ "May 29 to June 26"
  )) %>%
  dplyr::group_by(Period) %>%
  dplyr::summarise(Mean_Temperature = mean(Temperature, na.rm = TRUE))
mean_temps
```


```{r}
datalog_Temperature_sum<-summarySE(merged_datalog_clean, measurevar='Temperature_clean', groupvars=c('Treatment','Date_Time'), na.rm=TRUE, conf.interval = 0.95)
datalog_Temperature_sum
```

```{r}
#water_all_Temperature$Date<- as.Date(as.POSIXct(water_all_Temperature$Date, origin="1970-01-01"))
Temperature_apex_timeseries_fig<-ggplot(datalog_Temperature_sum, aes(y=Temperature_clean, x=Date_Time, color=Treatment, fill=Treatment))+
  geom_path(size=1)+
  #facet_wrap(~type, scales="free")+
  #geom_smooth()+
  #geom_line()+
  geom_ribbon(aes(ymin=Temperature_clean-se, ymax=Temperature_clean+se, stat="identity"), alpha=0.4, color=NA)+
  #geom_hline(yintercept = 27.4, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  #geom_hline(yintercept = 28.4, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  #scale_x_discrete(expression(Time), breaks=c("0:00:00","6:00:00","12:00:00","18:00:00"))+
  #scale_x_datetime(expression(Date))+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12, angle=90),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position=c(0.85,0.85),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))#making the axis title larger 
Temperature_apex_timeseries_fig
```

```{r}
library(cowplot)
Apex_both<-cowplot::plot_grid(Temperature_apex_timeseries_fig,pH_apex_timeseries_fig,nrow=1,ncol=2,align="h", axis = "bt")
Apex_both
```
#Seawater carbonate chem

```{r}
library(seacarb)
cc<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu Project/Seawater carbontate chemistry sampling log - 6.25.csv", strip.white=T)
cc$Date<-as.Date(cc$Date)
cc$Date_Time<- as.POSIXct(paste(cc$Date, cc$Time.of.day), "%Y-%m-%d hh:mm:ss")
cc$Treatment<-as.factor(cc$Treatment)
cc$Tank<-as.factor(cc$Tank)
cc
cc_seacarb<-carb(flag=8, var1=cc$pH, var2=cc$AT, S=cc$Salinity, T=cc$Temperature)
cc_seacarb
cc_seacarb<- plyr::rename(cc_seacarb, c("S"="Salinity"))
```
```{r}
cc_merged<- merge(cc, cc_seacarb, by=c("Salinity", "pH"), all=T)
cc_merged <- cc_merged %>%
  mutate(Time24 = ifelse(grepl("^12", Time), 
                         Time, 
                         format(strptime(Time, format="%I:%M") + hours(12), "%H:%M")))
cc_merged$Date_Time <- as.POSIXct(paste(cc_merged$Date, cc_merged$Time24), format="%Y-%m-%d %H:%M")
cc_merged
```
```{r}
cc_pH_sum<-summarySE(cc_merged, measurevar='pH', groupvars=c("Where", "Time.of.day", "Treatment"), na.rm=TRUE, conf.interval = 0.95)
cc_pH_sum
```

```{r}
cc_DO_sum<-summarySE(cc_merged, measurevar='DO', groupvars=c("Where", "Time.of.day", "Treatment"), na.rm=TRUE, conf.interval = 0.95)
cc_DO_sum
```
```{r}
cc_Salinity_sum<-summarySE(cc_merged, measurevar='Salinity', groupvars=c("Where", "Time.of.day", "Treatment"), na.rm=TRUE, conf.interval = 0.95)
cc_Salinity_sum
```

```{r}
cc_pCO2_sum<-summarySE(cc_merged, measurevar='pCO2', groupvars=c("Where", "Time.of.day", "Treatment"), na.rm=TRUE, conf.interval = 0.95)
cc_pCO2_sum
```
```{r}
cc_AT_sum<-summarySE(cc_merged, measurevar='TA.1', groupvars=c("Where", "Time.of.day", "Treatment"), na.rm=TRUE, conf.interval = 0.95)
cc_AT_sum
```

```{r}
cc_OmegaAragonite_sum<-summarySE(cc_merged, measurevar='OmegaAragonite', groupvars=c("Where", "Time.of.day", "Treatment"), na.rm=TRUE, conf.interval = 0.95)
cc_OmegaAragonite_sum
```

```{r}
pH2.lme <- lme(pH~Where*Treatment*Time.of.day,random = ~1|Tank, data=cc_merged, na.action=na.exclude)
Anova(pH2.lme, type=3)
tukey3<- emmeans(pH2.lme, list(pairwise ~ Where:Treatment:Time.of.day), adjust = "tukey", simple= "Treatment")
tukey3
```
##pH

```{r}
library(Rmisc)
pH_sum_himb<-summarySE(cc_merged, measurevar="pH", groupvars=c("Treatment", "Time.of.day"), na.rm=TRUE)
pH_sum_himb
```

```{r}
library(Rmisc)
pH_sum<-summarySE(cc_merged, measurevar="pH", groupvars=c("Where","Treatment","Time.of.day"), na.rm=TRUE)
pH_sum
```

####Figure
```{r,warning=FALSE}
pH_sum$Time.of.day<- factor(pH_sum$Time.of.day, levels =c("Evening","Afternoon"))
pH_fig_sum2<-ggplot(pH_sum, aes(y=pH, x=Time.of.day, color=Treatment))+
  geom_point(size=3)+
  #geom_point(data=cc_merged, aes(y=pH, x=Time.of.day, color=Treatment),alpha=0.6)+
  geom_path(aes(group = interaction(Treatment), stat="identity"))+
  geom_errorbar(aes(ymin=pH-se, ymax=pH+se), stat="identity",width=0.1)+
  facet_wrap(~Where, scales="free")+
  scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(pH), expand=c(0.015,0.015))+
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #scale_fill_manual("probe", values=c("2"= '#1c9099',"3"='#dfc27d',"1"="#bf812d", "4"="#8c510a"), labels=c("Control","Limu-low","Limu-medium","Limu-high"))+ #Manually choose the colors
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12),
        strip.text = element_text(vjust=0.5, size=12))#making the axis title larger 
pH_fig_sum2
```
####Figure
```{r,warning=FALSE}
cc_merged_himb_sum$Time.of.day<- factor(cc_merged_himb_sum$Time.of.day, levels =c("Evening","Afternoon"))
cc_merged_himb$Time.of.day<- factor(cc_merged_himb$Time.of.day, levels =c("Evening","Afternoon"))
pH_fig_sum_himb<-ggplot(cc_merged_himb_sum, aes(y=pH, x=Time.of.day, color=Treatment))+
  geom_point(data=cc_merged_himb, aes(y=pH, x=Time.of.day, color=Treatment),alpha=0.5,position = position_jitter(width = 0.03, height = 0))+
  geom_path(aes(group = interaction(Treatment), stat="identity"))+
  geom_point(size=3)+
  geom_errorbar(aes(ymin=pH-se, ymax=pH+se), stat="identity",width=0.1)+
  #facet_wrap(~Where, scales="free")+
  scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(pH), expand=c(0.015,0.015),limits=c(7.9,8.4))+
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #scale_fill_manual("probe", values=c("2"= '#1c9099',"3"='#dfc27d',"1"="#bf812d", "4"="#8c510a"), labels=c("Control","Limu-low","Limu-medium","Limu-high"))+ #Manually choose the colors
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12),
        strip.text = element_text(vjust=0.5, size=12))#making the axis title larger 
pH_fig_sum_himb
```
```{r,warning=FALSE}
cc_merged_himb_sum$Time.of.day<- factor(cc_merged_himb_sum$Time.of.day, levels =c("Evening","Afternoon"))
cc_merged_himb$Time.of.day<- factor(cc_merged_himb$Time.of.day, levels =c("Evening","Afternoon"))
pH_fig_sum_himb2<-ggplot(cc_merged_himb_sum, aes(y=pH, x=Time.of.day, color=Treatment))+
  #geom_point(data=cc_merged_himb, aes(y=pH, x=Time.of.day, color=Treatment),alpha=0.5,position = position_jitter(width = 0.05, height = 0))+
  geom_path(aes(group = interaction(Treatment), stat="identity"))+
  geom_point(size=3)+
  geom_errorbar(aes(ymin=pH-se, ymax=pH+se), stat="identity",width=0.1)+
  #facet_wrap(~Where, scales="free")+
  scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(pH), expand=c(0.015,0.015), limits=c(7.9,8.3),breaks=c(7.9,8.0,8.1,8.2,8.3))+
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #scale_fill_manual("probe", values=c("2"= '#1c9099',"3"='#dfc27d',"1"="#bf812d", "4"="#8c510a"), labels=c("Control","Limu-low","Limu-medium","Limu-high"))+ #Manually choose the colors
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12),
        strip.text = element_text(vjust=0.5, size=12))#making the axis title larger 
pH_fig_sum_himb2
```

```{r}
library(Rmisc)
pH_sum_date<-summarySE(cc_merged, measurevar="pH", groupvars=c("Where","Treatment","Time.of.day", "Date"), na.rm=TRUE)
pH_sum_date
```

```{r,warning=FALSE}
pH_sum_date$Time.of.day<- factor(pH_sum_date$Time.of.day, levels =c("Evening","Afternoon"))
pH_fig_2<-ggplot(pH_sum_date, aes(y=pH, x=Date, color=Treatment, shape=Time.of.day))+
  geom_point(size=3)+
  geom_point(data=cc_merged, aes(y=pH, x=Date, color=Treatment),alpha=0.6)+
  geom_path(aes(group = interaction(Treatment, Time.of.day), stat="identity"))+
  geom_errorbar(aes(ymin=pH-se, ymax=pH+se), stat="identity",width=0.1)+
  facet_wrap(~Where, scales="free")+
  #scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(pH), expand=c(0.015,0.015))+
  scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  #scale_fill_manual("probe", values=c("2"= '#1c9099',"3"='#dfc27d',"1"="#bf812d", "4"="#8c510a"), labels=c("Control","Limu-low","Limu-medium","Limu-high"))+ #Manually choose the colors
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12),
        strip.text = element_text(vjust=0.5, size=12))#making the axis title larger 
pH_fig_2
```
```{r}
cc_merged_himb<-cc_merged%>% filter(Where != "Waikalua")
cc_merged_himb$hour <- as.POSIXlt(cc_merged_himb$Date_Time)$hour
cc_merged_himb$hour <- sprintf("%02d:00:00", cc_merged_himb$hour)
cc_merged_himb$Date_Time2 <- as.POSIXct(paste(cc_merged_himb$Date, cc_merged_himb$hour))
cc_merged_himb
cc_merged_himb_sum<-summarySE(cc_merged_himb, measurevar="pH", groupvars=c("Treatment","Time.of.day"), na.rm=TRUE)
cc_merged_himb_sum
```


###Stats
```{r}
pH3.lme <- lme(pH~Treatment*Time.of.day,random = ~1|Tank, data=cc_merged_himb, na.action=na.exclude)
Anova(pH3.lme, type=3)
tukey3<- emmeans(pH3.lme, list(pairwise ~ Treatment:Time.of.day), adjust = "tukey", simple= "Treatment")
tukey3
```
```{r}
DO.lme <- lme(DO~Treatment*Time.of.day,random = ~1|Tank, data=cc_merged_himb, na.action=na.exclude)
Anova(DO.lme, type=3)
tukey3<- emmeans(DO.lme, list(pairwise ~ Treatment:Time.of.day), adjust = "tukey", simple= "Treatment")
tukey3
```
```{r}
TA.1.lme <- lme(OmegaAragonite~Treatment*Time.of.day,random = ~1|Tank, data=cc_merged_himb, na.action=na.exclude)
Anova(TA.1.lme, type=3)
tukey3<- emmeans(TA.1.lme, list(pairwise ~ Treatment:Time.of.day), adjust = "tukey", simple= "Treatment")
tukey3
```
```{r}
pCO2.lme <- lme(pCO2~Treatment*Time.of.day,random = ~1|Tank, data=cc_merged_himb, na.action=na.exclude)
Anova(pCO2.lme, type=3)
tukey3<- emmeans(pCO2.lme, list(pairwise ~ Treatment:Time.of.day), adjust = "tukey", simple= "Treatment")
tukey3
```

####Figure - all with weekly
```{r}
datalog_pH_sum$Treatment <- factor(datalog_pH_sum$Treatment, levels=c("Limu","Control"))
pH_apex_timeseries_fig2<-ggplot(datalog_pH_sum, aes(y=pH_clean, x=Date_Time, color=Treatment, fill=Treatment))+
  geom_path(size=1)+
  geom_ribbon(aes(ymin=pH_clean-se, ymax=pH_clean+se), alpha=0.4, color=NA)+
  #geom_point(data=cc_merged_himb, aes(y=pH,x=Date_Time2, color=Time.of.day, fill=Treatment),position=position_jitterdodge(0.05),size=2,stroke=1, shape=21)+
  scale_x_datetime()+
  scale_y_continuous(expression(pH), breaks=c(7.7,7.8,7.9,8.0,8.1,8.2,8.3,8.4))+
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
pH_apex_timeseries_fig2
```
```{r}
hobo_temp_all_sum$Treatment <- factor(hobo_temp_all_sum$Treatment, levels=c("Limu","Control"))
hobo_temp_timeseries_fig<-ggplot(hobo_temp_all_sum, aes(y=Temperature, x=Date_Time))+
  #geom_point(data=cc_merged, aes(y=pH,x=Date_Time, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path(size=0.5, color="grey50")+
  geom_ribbon(aes(ymin=Temperature-se, ymax=Temperature+se), alpha=0.4, color=NA)+
  #geom_point(data=cc_merged_himb, aes(y=Temperature,x=Date_Time2),position=position_jitterdodge(0.05),size=2,stroke=1, shape=21)+
  scale_x_datetime()+
  scale_y_continuous(expression(Temperature~(degree~C)), breaks=c(24,25,26,27,28,29))+
  #scale_color_manual("Treatment", values=c("Afternoon" = "grey60", "Evening" = "black"))+
  #scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  geom_vline(xintercept = as.POSIXct("2024-05-28 12:00"), color = "black", linetype = "dashed", size = 1) +
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
hobo_temp_timeseries_fig
```
###***Figure for paper*** pH_fig_sum_himb
```{r}
library(cowplot)
pH_fig_top<-plot_grid(hobo_temp_timeseries_fig, PAR_fig, ncol=2, nrow=1, align="h", axis = "bt") 
pH_fig_top
pH_fig_bottom<-plot_grid(pH_apex_timeseries_fig2, pH_apex_timeseries_fig_hour,pH_fig_sum_himb, ncol=3, nrow=1, align="h", axis = "bt") 
pH_fig_bottom
pH_fig_both<-plot_grid(pH_fig_top, pH_fig_bottom, ncol=1, nrow=4, align="h", axis = "bt") 
pH_fig_both
```


```{r}
library(Rmisc)
PAR_sum_date<-summarySE(cc_merged, measurevar="PAR", groupvars=c("Where","Treatment","Time.of.day", "Date"), na.rm=TRUE)
PAR_sum_date
```



```{r,warning=FALSE}
PAR_sum_date$Time.of.day<- factor(PAR_sum_date$Time.of.day, levels =c("Evening","Afternoon"))
PAR_fig_2<-ggplot(PAR_sum_date, aes(y=PAR, x=Date, color=Treatment, shape=Time.of.day))+
  geom_point(size=3)+
  geom_point(data=cc_merged, aes(y=PAR, x=Date, color=Treatment),alPARa=0.6)+
  geom_path(aes(group = interaction(Treatment, Time.of.day), stat="identity"))+
  geom_errorbar(aes(ymin=PAR-se, ymax=PAR+se), stat="identity",width=0.1)+
  facet_wrap(~Where, scales="free")+
  #scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(PAR), expand=c(0.015,0.015))+
  scale_color_manual("Treatment", values=c("Control"= '#225ea8', "Limu"="#a63603"))+
  #scale_fill_manual("probe", values=c("2"= '#1c9099',"3"='#dfc27d',"1"="#bf812d", "4"="#8c510a"), labels=c("Control","Limu-low","Limu-medium","Limu-high"))+ #Manually choose the colors
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graPAR
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12),
        strip.text = element_text(vjust=0.5, size=12))#making the axis title larger 
PAR_fig_2
```

```{r,warning=FALSE}
PARv.pH<-ggplot(data=cc_merged, aes(y=PAR,x=pH))+ 
  geom_point()+
  geom_smooth(method='lm')+
  facet_wrap(~Where, scales="free")+
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=16),"Juvenile"=(pch=4), "NA"=(pch=0)))+
  scale_color_brewer(palette = "RdBu")+
  scale_fill_brewer(palette = "RdBu")+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        #legend.position="none",
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(vjust=0.5, size=12))
PARv.pH
```
##pCO2
```{r}
library(Rmisc)
pCO2_sum<-summarySE(cc_merged, measurevar="pCO2", groupvars=c("Where","Treatment","Time.of.day"), na.rm=TRUE)
pCO2_sum
```

####Figure
```{r,warning=FALSE}
pCO2_sum$Time.of.day<- factor(pCO2_sum$Time.of.day, levels =c("Evening","Afternoon"))
pCO2_fig_2<-ggplot(pCO2_sum, aes(y=pCO2, x=Time.of.day, color=Treatment))+
  geom_point(size=3)+
  geom_point(data=cc_merged, aes(y=pCO2, x=Time.of.day, color=Treatment),alpha=0.8)+
  geom_path(aes(group = interaction(Treatment), stat="identity"))+
  geom_errorbar(aes(ymin=pCO2-se, ymax=pCO2+se), stat="identity",width=0.1)+
  facet_wrap(~Where)+
  scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(pCO[2]~(mu~atm)), expand=c(0.015,0.015))+
  scale_color_manual("Treatment", values=c("Control"= '#225ea8', "Limu"="#a63603"))+
  #scale_fill_manual("probe", values=c("2"= '#1c9099',"3"='#dfc27d',"1"="#bf812d", "4"="#8c510a"), labels=c("Control","Limu-low","Limu-medium","Limu-high"))+ #Manually choose the colors
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12),
        strip.text = element_text(vjust=0.5, size=12))#making the axis title larger 
pCO2_fig_2
```
####Stats
```{r}
pCO2.lme <- lme(pCO2~Where*Treatment*Time.of.day,random = ~1|Tank, data=cc_merged, na.action=na.exclude)
Anova(pCO2.lme, type=3)
tukey3<- emmeans(pCO2.lme, list(pairwise ~ Where:Treatment:Time.of.day), adjust = "tukey", simple= "Treatment")
tukey3
```
##Alkalinity
```{r}
library(Rmisc)
alk_sum<-summarySE(cc_merged, measurevar="TA.1", groupvars=c("Where","Treatment","Time.of.day"), na.rm=TRUE)
alk_sum
```

####Figure
```{r,warning=FALSE}
alk_sum$Time.of.day<- factor(alk_sum$Time.of.day, levels =c("Evening","Afternoon"))
alk_fig_2<-ggplot(alk_sum, aes(y=TA.1, x=Time.of.day, color=Treatment))+
  geom_point(size=3)+
  geom_point(data=cc_merged, aes(y=TA.1, x=Time.of.day, color=Treatment),alpha=0.8)+
  geom_path(aes(group = interaction(Treatment), stat="identity"))+
  geom_errorbar(aes(ymin=TA.1-se, ymax=TA.1+se), stat="identity",width=0.1)+
  facet_wrap(~Where, scales="free")+
  scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(Total~alkalinity~(mu~mol~kg^-1)), expand=c(0.015,0.015))+
  scale_color_manual("Treatment", values=c("Control"= '#225ea8', "Limu"="#a63603"))+
  #scale_fill_manual("probe", values=c("2"= '#1c9099',"3"='#dfc27d',"1"="#bf812d", "4"="#8c510a"), labels=c("Control","Limu-low","Limu-medium","Limu-high"))+ #Manually choose the colors
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12),
        strip.text = element_text(vjust=0.5, size=12))#making the axis title larger 
alk_fig_2
```
####Stats
```{r}
TA.1.lme <- lme(TA.1~Where*Treatment*Time.of.day,random = ~1|Tank, data=cc_merged, na.action=na.exclude)
Anova(TA.1.lme, type=3)
tukey3<- emmeans(TA.1.lme, list(pairwise ~ Where:Time.of.day), adjust = "tukey", simple= "Where")
tukey3
```

```{r}
library(cowplot)
seacarb_all<-cowplot::plot_grid(pH_fig_2,pCO2_fig_2,alk_fig_2,nrow=1,ncol=3,align="h", axis = "bt")
seacarb_all
figures_all<-cowplot::plot_grid(Apex_both,seacarb_all,nrow=2,ncol=1,align="h", axis = "bt")
figures_all
```
#PAR

```{r}
PAR1<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/HIMB_PAR_calibrated_LIMU133640725389407860.csv", strip.white=T)
PAR1$Date <- as.POSIXct(PAR1$Date, format = "%d/%m/%Y")
PAR1$Date_Time<- as.POSIXct(paste(PAR1$Date, PAR1$Time), "%Y-%m-%d hh:mm:ss")
PAR1$Site<- "HIMB"
PAR1$Site<-as.factor(PAR1$Site)
PAR1$Treatment<- "NA"
PAR1$Treatment<-as.factor(PAR1$Treatment)
PAR1
```
```{r}
PAR2<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/HIMB2_PAR_calibrated_LIMU133640725918278607.csv", strip.white=T)
PAR2$Date <- as.POSIXct(PAR2$Date, format = "%d/%m/%Y")
PAR2$Date_Time<- as.POSIXct(paste(PAR2$Date, PAR2$Time), "%Y-%m-%d hh:mm:ss")
PAR2$Site<- "HIMB"
PAR2$Site<-as.factor(PAR2$Site)
PAR2$Treatment<- "NA"
PAR2$Treatment<-as.factor(PAR2$Treatment)
PAR2
```

```{r}
PAR3<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Control_Fishpond_PAR_calibrated_LIMU133640724281914281.csv", strip.white=T)
PAR3$Date <- as.POSIXct(PAR3$Date, format = "%d/%m/%Y")
PAR3$Date_Time<- as.POSIXct(paste(PAR3$Date, PAR3$Time), "%Y-%m-%d hh:mm:ss")
PAR3$Site<- "Waikalua"
PAR3$Site<-as.factor(PAR3$Site)
PAR3$Treatment<- "Limu"
PAR3$Treatment<-as.factor(PAR3$Treatment)
PAR3
```
```{r}
PAR4<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu_Fishpond_PAR_calibrated_LIMU133640723298465322.csv", strip.white=T)
PAR4$Date <- as.POSIXct(PAR4$Date, format = "%d/%m/%Y")
PAR4$Date_Time<- as.POSIXct(paste(PAR4$Date, PAR4$Time), "%Y-%m-%d hh:mm:ss")
PAR4$Site<- "Waikalua"
PAR4$Site<-as.factor(PAR4$Site)
PAR4$Treatment<- "Control"
PAR4$Treatment<-as.factor(PAR4$Treatment)
PAR4
```
```{r}
PAR_all <- merge(PAR1, PAR2, by=c("Date","Time","Date_Time","Site", "Treatment","Calibrated.Value","Raw.Value"), all=T)
PAR_all <- merge(PAR3, PAR_all, by=c("Date","Time","Date_Time","Site","Treatment","Calibrated.Value","Raw.Value"), all=T)
PAR_all <- merge(PAR4, PAR_all, by=c("Date","Time","Date_Time","Site","Treatment","Calibrated.Value","Raw.Value"), all=T)
PAR_all
```
```{r}
PAR_all$hour <- as.POSIXlt(PAR_all$Date_Time)$hour
PAR_all$day <- day(as.POSIXlt(PAR_all$Date_Time))
```
```{r}
PAR_hour<- PAR_all%>%
  dplyr::group_by(Site, Date, hour, Treatment) %>%
  dplyr::summarize(
    count = n(),
    Mean_PAR = mean(Calibrated.Value, na.rm = TRUE))

#PAR_hour$hour<- as.POSIXct.numeric((PAR_hour$hour), "hh:mm:ss")
PAR_himb<-PAR_all%>% filter(Site != "Waikalua")
PAR_himb$hour <- sprintf("%02d:00:00", PAR_himb$hour)
PAR_himb$Date_Time2 <- as.POSIXct(paste(PAR_himb$Date, PAR_himb$hour))
PAR_himb
PAR_himb_sum<-summarySE(PAR_himb, measurevar="Calibrated.Value", groupvars=c("Date_Time2"), na.rm=TRUE)
PAR_himb_sum
PAR_himb_sum$Date <- as.Date(PAR_himb_sum$Date_Time)
PAR_himb_sum  <- PAR_himb_sum %>%
  mutate(Week = week(ymd(Date)))
PAR_himb_sum
#PAR_hour$Date_Time<- as.POSIXct(paste(PAR_hour$Date, PAR_hour$hour), "%Y-%m-%d hh:mm:ss")
#PAR_hour
```

```{r}
PAR_himb_sum_week<-summarySE(PAR_himb_sum, measurevar='Calibrated.Value', groupvars=c("Week"), na.rm=TRUE, conf.interval = 0.95)
PAR_himb_sum_week
```

```{r}
mean_par <- PAR_all %>%
  mutate(Period = case_when(
    Date >= as.Date("2024-05-01") & Date <= as.Date("2024-05-28") ~ "May 1 to May 28",
    Date >= as.Date("2024-05-29") & Date <= as.Date("2024-06-26") ~ "May 29 to June 26"
  )) %>%
  dplyr::group_by(Period, Site) %>%
  dplyr::summarise(Mean_PAR = mean(Calibrated.Value, na.rm = TRUE))
mean_par
```

####Mean
```{r}
PAR_mean<- PAR_all%>%
  dplyr::group_by(Site) %>%
  dplyr::summarize(
    count = n(),
    mean_value = mean(Calibrated.Value, na.rm = TRUE))
PAR_mean
```
####Figure - all with weekly
```{r}
datalog_pH_sum$Treatment <- factor(datalog_pH_sum$Treatment, levels=c("Limu","Control"))
pH_apex_timeseries_fig_PAR<-ggplot(datalog_pH_sum, aes(y=pH_clean, x=Date_Time, color=Treatment, fill=Treatment))+
  #geom_path(data=PAR_himb_sum, aes(y=Calibrated.Value,x=Date_Time2))+
  geom_path(size=1)+
  geom_ribbon(aes(ymin=pH_clean-se, ymax=pH_clean+se), alpha=0.4, color=NA)+
  geom_point(data=cc_merged_himb, aes(y=pH,x=Date_Time2, color=Treatment, fill=Treatment),position=position_jitterdodge(0.05), color='black',size=2,stroke=1, shape=21)+
  scale_x_datetime()+
  scale_y_continuous(expression(pH), breaks=c(7.7,7.8,7.9,8.0,8.1,8.2,8.3,8.4), expand=c(0.015,0.015),)+
  scale_color_manual("Treatment", values=c("Limu"="#90C8AC","Control"= '#0A4D68'))+
  scale_fill_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
pH_apex_timeseries_fig_PAR
```
###PAR - Waikalua
```{r}
#PAR_hour$hour<- as.POSIXct.numeric((PAR_hour$hour), "hh:mm:ss")
PAR_wai<-PAR_all%>% filter(Site != "HIMB")
PAR_wai$hour <- sprintf("%02d:00:00", PAR_wai$hour)
PAR_wai$Date_Time2 <- as.POSIXct(paste(PAR_wai$Date, PAR_wai$hour))
PAR_wai
PAR_wai_sum<-summarySE(PAR_wai, measurevar="Calibrated.Value", groupvars=c("Date_Time2", "Treatment"), na.rm=TRUE)
PAR_wai_sum
PAR_wai_sum$Date <- as.Date(PAR_wai_sum$Date_Time)
PAR_wai_sum  <- PAR_wai_sum %>%
  mutate(Week = week(ymd(Date)))
PAR_wai_sum
#PAR_hour$Date_Time<- as.POSIXct(paste(PAR_hour$Date, PAR_hour$hour), "%Y-%m-%d hh:mm:ss")
#PAR_hour
```
```{r}
PAR_wai_sum$Treatment<- factor(PAR_wai_sum$Treatment, levels =c("Limu","Control"))
PAR_wai_fig<-ggplot(PAR_wai_sum, aes(y=Calibrated.Value, x=Date_Time2, color=Treatment, fill=Treatment))+
  #geom_point(size=1)+
  #geom_point(data=cc_merged, aes(y=pH, x=Date, color=Treatment),alpha=0.6)+
  geom_ribbon(aes(ymin = 0, ymax = Calibrated.Value), alpha = 0.5) +
  geom_path(aes(stat="identity"))+
  #geom_ribbon(aes(ymin=pH-se, ymax=pH+se), stat="identity",width=0.1)+
  #scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(Photosynthetically~active~radiation~"(PAR)"), expand=c(0.015,0.015))+
  scale_color_manual("Treatment", values=c("Control"= '#a6bddb', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#a6bddb', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position=c(0.89,0.89),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12),
        strip.text = element_text(vjust=0.5, size=12))#making the axis title larger 
PAR_wai_fig
```
```{r}
PAR.lme <- lm(Calibrated.Value~Treatment, data=PAR_wai_sum, na.action=na.exclude)
Anova(PAR.lme)
tukey3<- emmeans(PAR.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey3
```
```{r}
PAR_wai_sum_exp<-summarySE(PAR_wai_sum, measurevar='Calibrated.Value', groupvars=c("Treatment"), na.rm=TRUE, conf.interval = 0.95)
PAR_wai_sum_exp
```

```{r}
PAR_himb_sum_hour<-summarySE(PAR_himb, measurevar='Calibrated.Value', groupvars=c("hour"), na.rm=TRUE, conf.interval = 0.95)
PAR_himb_sum_hour
```
####Figure- by hour
```{r}
PAR_fig_hour<-ggplot(PAR_himb_sum_hour, aes(y=Calibrated.Value, x=hour))+
  #geom_point()+
  geom_path(group=1, color="grey", size=1)+
  #geom_smooth()+
  #geom_ribbon(aes(ymin=Calibrated.Value-ci, ymax=Calibrated.Value+ci),alpha=0.4, color="grey")+
  scale_y_continuous(expression(Photosynthetically~active~radiation~"(PAR)"), expand=c(0.015,0.015))+
  scale_x_discrete(breaks=c(00:00:00,05:00:00,10:00:00,15:00:00,20:00:00))+
  #scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  #scale_fill_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
PAR_fig_hour
```
####Figure
```{r,warning=FALSE}
#PAR_all$Site<- factor(PAR_all$Site, levels =c("HIMB","Waikalua"))
PAR_fig<-ggplot(PAR_himb_sum, aes(y=Calibrated.Value, x=Date_Time2))+
  #geom_point(size=1)+
  #geom_point(data=cc_merged, aes(y=pH, x=Date, color=Treatment),alpha=0.6)+
  geom_ribbon(aes(ymin = 0, ymax = Calibrated.Value), fill = "grey50", alpha = 0.5) +
  geom_path(aes(stat="identity"), color="grey50")+
  #geom_ribbon(aes(ymin=pH-se, ymax=pH+se), stat="identity",width=0.1)+
  #scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(Photosynthetically~active~radiation~"(PAR)"), expand=c(0.015,0.015))+
  #scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  #scale_fill_manual("probe", values=c("2"= '#1c9099',"3"='#dfc27d',"1"="#bf812d", "4"="#8c510a"), labels=c("Control","Limu-low","Limu-medium","Limu-high"))+ #Manually choose the colors
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12),
        strip.text = element_text(vjust=0.5, size=12))#making the axis title larger 
PAR_fig
```

```{r}
library(cowplot)
ph_PAR<-cowplot::plot_grid(pH_apex_timeseries_fig2,
                  pH_apex_timeseries_fig_hour,
                  pH_fig_sum_himb,
                  hobo_temp_timeseries_fig,
                  PAR_fig,
                  PAR_fig_hour,nrow=3,ncol=2,align="h", axis = "bt")
ph_PAR
```
#Dissolved oxygen - Waikalua
```{r}
control_do<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Fishpond_control_0.csv", strip.white=T)
control_do<-rename(control_do, replace = c("Date.Time..GMT.10.00" = "Date_Time","DO.conc..mg.L..LGR.S.N..21984908..SEN.S.N..21984908." = "DO","Temp...C..LGR.S.N..21984908..SEN.S.N..21984908." = "Temperature"))
control_do$Date_Time <- format(as.POSIXct(control_do$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
control_do <- control_do[, 2:4]
control_do$Treatment <- as.factor("Control")
#control_1$Tank<-as.factor("1")
control_do
```
```{r}
limu_do<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Fishpond_limu_0.csv", strip.white=T)
limu_do<-rename(limu_do, replace = c("Date.Time..GMT.10.00" = "Date_Time","DO.conc..mg.L..LGR.S.N..21984909..SEN.S.N..21984909." = "DO","Temp...C..LGR.S.N..21984909..SEN.S.N..21984909." = "Temperature"))
limu_do$Date_Time <- format(as.POSIXct(limu_do$Date_Time, format = "%m/%d/%Y %H:%M"), "%Y-%m-%d %H:%M:%S")
limu_do <- limu_do[, 2:4]
limu_do$Treatment <- as.factor("Limu")
#limu_1$Tank<-as.factor("1")
limu_do
```
```{r}
do_all<- merge(limu_do, control_do, by=c("Date_Time","DO", "Temperature", "Treatment"), all=T)
do_all$Date_Time <- as.POSIXct(do_all$Date_Time)
do_all
```

```{r}
do_all_sum<- do_all %>%
  mutate(
    Date_Time = as.POSIXct(Date_Time, format = "%Y-%m-%d %H:%M:%S"),
    Hour = format(Date_Time, "%H") %>% as.numeric(),
    Time_of_day = case_when(
      Hour >= 11 & Hour <= 13 ~ "Afternoon",
      Hour >= 8 & Hour <= 10  ~ "Evening",
      TRUE ~ "Other"
    )
  )
do_all_sum$Hour<-as.factor(do_all_sum$Hour)
do_all_sum
do_all_sum2<-summarySE(do_all_sum, measurevar='DO', groupvars=c('Treatment', "Time_of_day"), na.rm=TRUE, conf.interval = 0.95)
do_all_sum2
```


```{r}
cc_merged_wai<-cc_merged%>% filter(Where != "HIMB")
cc_merged_wai$hour <- as.POSIXlt(cc_merged_wai$Date_Time)$hour
cc_merged_wai$hour <- sprintf("%02d:00:00", cc_merged_wai$hour)
cc_merged_wai$Date_Time2 <- as.POSIXct(paste(cc_merged_wai$Date, cc_merged_wai$hour))
cc_merged_wai
cc_merged_wai_sum<-summarySE(cc_merged_wai, measurevar="pH", groupvars=c("Treatment","Date_Time2"), na.rm=TRUE)
cc_merged_wai_sum
```

####Figure - all
```{r}
do_all$Treatment <- factor(do_all$Treatment, levels=c("Limu","Control"))
do_fig_all<-ggplot(do_all, aes(y=DO, x=Date_Time, color=Treatment, fill=Treatment))+
  #geom_point(data=cc_merged, aes(y=pH,x=Date_Time, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path(size=1)+
  #geom_ribbon(aes(ymin=Temperature-se, ymax=Temperature+se), alpha=0.4, color=NA)+
  scale_x_datetime()+
  scale_y_continuous(expression(Dissolved~oxygen~(mg~'\U2219'~L^{-1})), limits=c(0,17))+
  scale_color_manual("Treatment", values=c("Control"= '#a6bddb', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#a6bddb', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
do_fig_all
```
####Figure - temperature
```{r}
#temp_all$Treatment <- factor(temp_all$Treatment, levels=c("Limu","Control"))
temp_fig_all<-ggplot(do_all, aes(y=Temperature, x=Date_Time, color=Treatment, fill=Treatment))+
  #geom_point(data=cc_merged, aes(y=pH,x=Date_Time, color=Treatment),alpha=0.5,position=position_jittertempdge(0.05))+
  geom_path(size=1)+
  #geom_ribbon(aes(ymin=Temperature-se, ymax=Temperature+se), alpha=0.4, color=NA)+
  scale_x_datetime()+
  scale_y_continuous(expression(Temperature~(degree~C)), breaks=c(23,26,29,32))+
  scale_color_manual("Treatment", values=c("Control"= '#a6bddb', "Limu"="#a50f15"))+
  scale_fill_manual("Treatment", values=c("Control"= '#a6bddb', "Limu"="#a50f15"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
temp_fig_all
```
```{r}
library(cowplot)
wai_figs<-cowplot::plot_grid(temp_fig_all,PAR_wai_fig, do_fig_all,pH_fig_sum2,nrow=3,ncol=2,align="h", axis = "bt")
wai_figs
```

```{r}
do_all$Date <- as.Date(do_all$Date_Time)
do_all_sum2<-  summarySE(do_all, measurevar='Temperature', groupvars=c('Date', "Treatment"), na.rm=TRUE, conf.interval = 0.95)
do_all_sum2
do_all_sum<-  summarySE(do_all, measurevar='DO', groupvars=c('Date', "Treatment"), na.rm=TRUE, conf.interval = 0.95)
do_all_sum
```

```{r}
temp.lme <- lm(Temperature~Treatment, data=do_all_sum2, na.action=na.exclude)
Anova(temp.lme)
tukey3<- emmeans(temp.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey3
```

```{r}
do.lme <- lm(DO~Treatment*Hour, data=do_all_sum, na.action=na.exclude)
Anova(do.lme)
tukey3<- emmeans(do.lme, list(pairwise ~ Treatment:Hour), adjust = "tukey", simple="Treatment")
tukey3
```
```{r}
do_all_sum_hour<-  summarySE(do_all_sum, measurevar='DO', groupvars=c('Hour', "Treatment"), na.rm=TRUE, conf.interval = 0.95)
do_all_sum_hour
```

```{r}
library(cowplot)
ph_PAR<-cowplot::plot_grid(do_fig_all,
                  pH_wai,
                  pH_fig_sum_himb,
                  hobo_temp_timeseries_fig,
                  PAR_fig,
                  PAR_fig_hour,nrow=3,ncol=2,align="h", axis = "bt")
ph_PAR
```

```{r}
do_all$Treatment <- factor(do_all$Treatment, levels=c("Limu","Control"))
do_fig<-ggplot(do_all, aes(y=DO, x=Date_Time, color=Treatment, fill=Treatment))+
  #geom_point(data=cc_merged, aes(y=pH,x=Date_Time, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_path(size=1)+
  #geom_ribbon(aes(ymin=Temperature-se, ymax=Temperature+se), alpha=0.4, color=NA)+
  scale_x_datetime(limits = as.POSIXct(c("2024-05-01 00:00", "2024-05-30 00:00")))+
  scale_y_continuous(expression(Dissolved~oxygen~(mg~'\U2219'~L^{-1})), limits=c(6,11))+
  scale_color_manual("Treatment", values=c("Limu"="#90C8AC","Control"= '#0A4D68'))+
  scale_fill_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))
do_fig
```
#Flow rates
```{r}
flow<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Flow rates.csv", strip.white=T)
flow$Treatment<-as.factor(flow$Treatment)
#flow$Colony<-as.factor(flow$Colony)
flow$Tank<-as.factor(flow$Tank)
flow$Where<-as.factor(flow$Where)
flow$Date<-as.Date(flow$Date)
flow
```
```{r}
library(Rmisc)
flow_sum_date<-summarySE(flow, measurevar="Turnover..tub.hr.", groupvars=c("Treatment","Date"), na.rm=TRUE)
flow_sum_date
```
####Mean
```{r}
library(Rmisc)
flow_sum_exp<-summarySE(flow, measurevar="Turnover..tub.hr.", na.rm=TRUE)
flow_sum_exp
```
####Figure
```{r,warning=FALSE}
flow_fig_2<-ggplot(flow_sum_date, aes(y=Turnover..tub.hr., x=Date, color=Treatment))+
  geom_point(size=3)+
  geom_point(data=flow, aes(y=Turnover..tub.hr., x=Date, color=Treatment),alpha=0.6)+
  geom_path(aes(group = interaction(Treatment), stat="identity"))+
  geom_errorbar(aes(ymin=Turnover..tub.hr.-se, ymax=Turnover..tub.hr.+se), stat="identity",width=0.1)+
  facet_wrap(~Where, scales="free")+
  #scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(Tank~turnover~(~tank~'\U2219'~hr^{-1})), expand=c(0.015,0.015))+
  scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  #scale_fill_manual("probe", values=c("2"= '#1c9099',"3"='#dfc27d',"1"="#bf812d", "4"="#8c510a"), labels=c("Control","Limu-low","Limu-medium","Limu-high"))+ #Manually choose the colors
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12),
        strip.text = element_text(vjust=0.5, size=12))#making the axis title larger 
flow_fig_2
```

####Stats
```{r}
flow.lme <- lme(Turnover..tub.hr.~Treatment,random = ~1|Tank, data=flow, na.action=na.exclude)
Anova(flow.lme, type=2)
```
#Buoyant weight
```{r}
bw<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/BW start, middle, end.csv", strip.white=T)
bw$Treatment<-as.factor(bw$Treatment)
bw$Colony<-as.factor(bw$Colony)
bw$Tank<-as.factor(bw$Tank)
bw$ID<-as.factor(bw$ID)
bw$Date<-as.Date(bw$Date)
bw
```
```{r}
# Spread the data into wide format
library(tidyr)
bw_wide <- spread(bw, key = Date, value = Weight)

# Calculate the difference and percentage change
bw_wide <- bw_wide %>%
  group_by(ID) %>%
  mutate(
    Difference_sm = `2024-05-30` - `2024-04-29`,
    PercentChange_sm = (`2024-05-30` - `2024-04-29`) / `2024-04-29` * 100,
    PercentchangeDay_sm = PercentChange_sm / 31
  )
bw_wide

bw_wide <- bw_wide %>%
  group_by(ID) %>%
  mutate(
    Difference_se = `2024-06-24` - `2024-04-29`,
    PercentChange_se = (`2024-06-24` - `2024-04-29`) / `2024-04-29` * 100,
    PercentchangeDay_se = PercentChange_se / 56
  )
bw_wide

bw_wide <- bw_wide %>%
  group_by(ID) %>%
  mutate(
    Difference_me = `2024-06-24` - `2024-05-30`,
    PercentChange_me = (`2024-06-24` - `2024-05-30`) / `2024-05-30` * 100,
    PercentchangeDay_me = PercentChange_me / 25
  )
bw_wide
```
```{r}
hist(bw_wide$PercentchangeDay_se)
```

```{r}
bw.lm<- lm(PercentchangeDay_se~Treatment,random=~1|Colony, data=bw_wide, na.action = na.exclude)
par(mfrow=c(2,3))
plot(bw.lm, ask=FALSE, which=1:6)
```
```{r}
bw_wide_2 <- bw_wide[-c(66), ]
```
####Stats
```{r}
bw.lme<- lme(PercentchangeDay_se~Treatment,random=~1|Colony/Tank, data=bw_wide_2, na.action = na.exclude)
Anova(bw.lme)
```
####Figure
```{r}
bw_figure<- ggplot(bw_wide_2, (aes(y=PercentchangeDay_se, x=Treatment, fill=Treatment)))+  
  geom_boxplot(coef=1.5)+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  scale_y_continuous(expression(Relative~change~'in'~net~calcification~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01))+ 
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
bw_figure
```
```{r}
bw_sum<- summarySE(bw_wide_2, measurevar='PercentchangeDay_se', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
bw_sum
```
```{r}
#allcal$Light <- factor(allcal$Light, levels=c("Light","Dark"))
bw_figure2<-ggplot(bw_sum, aes(y=PercentchangeDay_se, x=Treatment, color=Treatment))+ 
  #geom_point(data=bw_wide_2, aes(y=PercentchangeDay,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=PercentchangeDay_se-se, ymax=PercentchangeDay_se+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Relative~change~'in'~net~calcification~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
bw_figure2
```
##BW over time

```{r}
bw_time<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/BW relative change.csv", strip.white=T)
bw_time$Tank<-as.factor(bw_time$Tank)
bw_time$Treatment<-as.factor(bw_time$Treatment)
bw_time$Colony<-as.factor(bw_time$Colony)
bw_time$Timepont<-as.factor(bw_time$Timepont)
bw_time
```

```{r}
hist(bw_time$Changeperday)
```

```{r}
bw.lm<- lm(Changeperday~Treatment,random=~1|Colony, data=bw_time, na.action = na.exclude)
par(mfrow=c(2,3))
plot(bw.lm, ask=FALSE, which=1:6)
```
```{r}
bw_time_2 <- bw_time[-c(14), ]
```
####Stats
```{r}
bw.lme<- lme(Changeperday~Treatment*Timepont,random=~1|Colony/Tank, data=bw_time, na.action = na.exclude)
Anova(bw.lme)
```
```{r}
bw_sum_time<- summarySE(bw_time, measurevar='Changeperday', groupvars=c('Treatment', 'Timepont'), na.rm=TRUE, conf.interval = 0.95)
bw_sum_time
```

```{r}
bw_sum_time$Timepont <- factor(bw_sum_time$Timepont, levels=c("Middle","End"))
bw_time$Timepont <- factor(bw_time$Timepont, levels=c("Middle","End"))
bw_figure_time<-ggplot(bw_sum_time, aes(y=Changeperday, x=Timepont, color=Treatment))+ 
  geom_point(data=bw_time, aes(y=Changeperday,x=Timepont, color=Treatment),alpha=0.5,position=position_dodge(0.5))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=Changeperday-se, ymax=Changeperday+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Relative~change~'in'~net~calcification~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01), limits=c(0,0.8))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
bw_figure_time
```
##Surface area


```{r}
sa<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu_project_2024_surface area_percent change2.csv", strip.white=T)
sa <- sa %>% 
  dplyr::filter(!grepl("_closed$", Model))%>%
  mutate(Temp = Model) %>%
  extract(Temp, into = c("Genotype", "Numbers"), regex = "([A-Za-z]+)([0-9]+)")%>%
  filter(Genotype != "S")%>%
  mutate(Numbers = as.numeric(Numbers))%>%
  mutate(Treatment = ifelse(Numbers %% 2 == 0, "Limu", "Control"))
sa <- plyr::rename(sa, c("Chunk"="ID", "Numbers"="Tank"))
sa
sa$Treatment<-as.factor(sa$Treatment)
sa$Genotype<-as.factor(sa$Genotype)
sa$Tank<-as.factor(sa$Tank)
sa$ID<-as.factor(sa$ID)
sa
```
```{r}
hist(sa$Percent.change.per.day_se)
```

```{r}
sa.lm<- lm(Percent.change.per.day_se~Treatment,random=~1|Colony, data=sa, na.action = na.exclude)
par(mfrow=c(2,3))
plot(sa.lm, ask=FALSE, which=1:6)
```
```{r}
#sa_wide_2 <- sa_wide[-c(66), ]
```
####Stats
```{r}
sa.lme<- lme(Percent.change.per.day_se~Treatment,random=~1|Genotype/Tank, data=sa, na.action = na.exclude)
Anova(sa.lme)
```
####Figure
```{r}
sa_figure<- ggplot(sa, (aes(y=Percent.change.per.day_se, x=Treatment, fill=Treatment)))+  
  geom_boxplot(coef=1.5)+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  theme_classic()+
  scale_y_continuous(expression(Relative~change~'in'~net~calcification~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01))+ 
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
sa_figure
```
```{r}
sa_sum<- summarySE(sa, measurevar='Percent.change.per.day_se', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
sa_sum
```
```{r}
#allcal$Light <- factor(allcal$Light, levels=c("Light","Dark"))
sa_figure2<-ggplot(sa_sum, aes(y=Percent.change.per.day_se, x=Treatment, color=Treatment))+ 
  #geom_point(data=sa_wide_2, aes(y=PercentchangeDay,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=Percent.change.per.day_se-se, ymax=Percent.change.per.day_se+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Relative~change~'in'~surface~area~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
sa_figure2
```
##SA over time

```{r}
sa_time<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu_project_2024_surface area change over time.csv", strip.white=T)
sa_time <- sa_time %>% 
  dplyr::filter(!grepl("_closed$", Model))%>%
  mutate(Temp = Model) %>%
  extract(Temp, into = c("Genotype", "Numbers"), regex = "([A-Za-z]+)([0-9]+)")%>%
  filter(Genotype != "S")%>%
  mutate(Numbers = as.numeric(Numbers))%>%
  mutate(Treatment = ifelse(Numbers %% 2 == 0, "Limu", "Control"))
sa_time <- plyr::rename(sa_time, c("Chunk"="ID", "Numbers"="Tank"))
sa_time
sa$Treatment<-as.factor(sa$Treatment)
sa$Genotype<-as.factor(sa$Genotype)
sa$Tank<-as.factor(sa$Tank)
sa$ID<-as.factor(sa$ID)
sa_time
```

```{r}
hist(sa_time$Percent.change.per.day)
```

```{r}
sa.lm<- lm(Percent.change.per.day~Treatment,random=~1|Colony, data=sa_time, na.action = na.exclude)
par(mfrow=c(2,3))
plot(sa.lm, ask=FALSE, which=1:6)
```
```{r}
#sa_time_2 <- sa_time[-c(14), ]
```
####Stats
```{r}
sa.lme<- lme(Percent.change.per.day~Treatment*Timepoint,random=~1|Genotype/Tank, data=sa_time, na.action = na.exclude)
Anova(sa.lme)
```
```{r}
sa_sum_time<- summarySE(sa_time, measurevar='Percent.change.per.day', groupvars=c('Treatment', 'Timepoint'), na.rm=TRUE, conf.interval = 0.95)
sa_sum_time
```

```{r}
sa_sum_time$Timepoint <- factor(sa_sum_time$Timepoint, levels=c("Middle","End"))
sa_time$Timepoint <- factor(sa_time$Timepoint, levels=c("Middle","End"))
sa_figure_time<-ggplot(sa_sum_time, aes(y=Percent.change.per.day, x=Timepoint, color=Treatment))+ 
  geom_point(data=sa_time, aes(y=Percent.change.per.day,x=Timepoint, color=Treatment),alpha=0.5,position=position_dodge(0.5))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=Percent.change.per.day-se, ymax=Percent.change.per.day+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Relative~change~'in'~net~calcification~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
sa_figure_time
```

##Volume

```{r}
vol<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu_project_2024_volume_percent change.csv", strip.white=T)
vol <- vol %>% 
  #dplyr::filter(!grepl("_closed$", Model))%>%
  mutate(Temp = Model) %>%
  extract(Temp, into = c("Genotype", "Numbers"), regex = "([A-Za-z]+)([0-9]+)")%>%
  filter(Genotype != "S")%>%
  mutate(Numbers = as.numeric(Numbers))%>%
  mutate(Treatment = ifelse(Numbers %% 2 == 0, "Limu", "Control"))
vol <- plyr::rename(vol, c("Chunk"="ID", "Numbers"="Tank"))
vol <- vol[vol$Percent.change.per.day != "#DIV/0!", ]
vol$Treatment<-as.factor(vol$Treatment)
vol$Genotype<-as.factor(vol$Genotype)
vol$Tank<-as.factor(vol$Tank)
vol$ID<-as.factor(vol$ID)
vol$Percent.change.per.day<-as.numeric(vol$Percent.change.per.day)
vol
```

```{r}
hist(vol$Percent.change.per.day)
```

```{r}
vol.lm<- lm(Percent.change.per.day~Treatment,random=~1|Colony, data=vol, na.action = na.exclude)
par(mfrow=c(2,3))
plot(vol.lm, ask=FALSE, which=1:6)
```
####Stats
```{r}
vol.lme<- lme(Percent.change.per.day~Treatment,random=~1|Genotype/Tank, data=vol, na.action = na.exclude)
Anova(vol.lme)
```
```{r}
vol.lme<- lme(Percent.change.per.day~Treatment*Timepoint,random=~1|Genotype/Tank, data=vol, na.action = na.exclude)
Anova(vol.lme)
```

```{r}
vol_sum<- summarySE(vol, measurevar='Percent.change.per.day', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
vol_sum
```
```{r}
#allcal$Light <- factor(allcal$Light, levels=c("Light","Dark"))
vol_figure2<-ggplot(vol_sum, aes(y=Percent.change.per.day, x=Treatment, color=Treatment))+ 
  #geom_point(data=sa_wide_2, aes(y=PercentchangeDay,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=Percent.change.per.day-se, ymax=Percent.change.per.day+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Percent~change~'in'~volume~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
vol_figure2
```
#Surface area to volume ratio over time
```{r}
savol<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu_project_2024_data_measurements_all.csv", strip.white=T)
savol <- savol %>% 
  #dplyr::filter(!grepl("_closed$", Model))%>%
  mutate(Temp = Model) %>%
  extract(Temp, into = c("Genotype", "Numbers"), regex = "([A-Za-z]+)([0-9]+)")%>%
  filter(Genotype != "S")%>%
  mutate(Numbers = as.numeric(Numbers))%>%
  mutate(Treatment = ifelse(Numbers %% 2 == 0, "Limu", "Control"))
savol <- plyr::rename(savol, c("Chunk"="ID", "Numbers"="Tank"))
savol <- savol[savol$SA.Vol != "#DIV/0!", ]
savol$Treatment<-as.factor(savol$Treatment)
savol$Genotype<-as.factor(savol$Genotype)
savol$Tank<-as.factor(savol$Tank)
savol$ID<-as.factor(savol$ID)
savol$Timepoint<-as.factor(savol$Timepoint)
savol$SA.Vol<- as.numeric(savol$SA.Vol)
savol
```
```{r}
hist(savol$SA.Vol)
```

```{r}
savol.lm<- lm(SA.Vol~Treatment,random=~1|Colony, data=savol, na.action = na.exclude)
par(mfrow=c(2,3))
plot(savol.lm, ask=FALSE, which=1:6)
```
####Stats
```{r}
savol.lme<- lme(SA.Vol~Treatment*Timepoint,random=~1|Genotype/Tank, data=savol, na.action = na.exclude)
Anova(savol.lme)
tukey<- emmeans(savol.lme, list(pairwise ~Treatment:Timepoint), adjust = "tukey")
tukey
```
```{r}
savol_sum<- summarySE(savol, measurevar='SA.Vol', groupvars=c('Treatment', "Timepoint"), na.rm=TRUE, conf.interval = 0.95)
savol_sum
```

```{r}
#allcal$Light <- factor(allcal$Light, levels=c("Light","Dark"))
vol_figure2<-ggplot(savol_sum, aes(y=SA.Vol, x=Timepoint, color=Treatment))+ 
  #geom_point(data=sa_wide_2, aes(y=PercentchangeDay,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=SA.Vol-se, ymax=SA.Vol+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Percent~change~'in'~volume~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
vol_figure2
```
#Adult coral survival
```{r}
adult_surv<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Adult coral survival.csv", strip.white=T)
adult_surv$Treatment<-as.factor(adult_surv$Treatment)
adult_surv$Date<-as.Date(adult_surv$Date)
adult_surv
```
####Figure
```{r}
adult_survival_figure<-ggplot(adult_surv, aes(y=mean_survival, x=Date, color=Treatment, fill=Treatment))+ 
  #geom_point(data=adult_alive, aes(y=Percent.change.per.day,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=2,stat="identity")+
  geom_line(aes(group = interaction(Treatment), stat="identity"))+
  geom_ribbon(aes(ymin=mean_survival-se_survival, ymax=mean_survival+se_survival), alpha=0.4, color=NA)+
  #geom_smooth()+
  #geom_errorbar(aes(ymin=Percent.change.per.day-se, ymax=Percent.change.per.day+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Adult~coral~survival~"(%)"), expand = c(0.01,0.01), limits=c(0,100))+ 
  #scale_x_date(limitsbreaks="15 days")+
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
   scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #geom_hline(yintercept = 0, linetype = 1, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_blank(),
        axis.title.y = element_text(vjust=0.5, size=12))
adult_survival_figure
```

#Juvenile coral survival
```{r}
juv_sa_surv<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Juvenile surface area -test.csv", strip.white=T)
juv_sa_surv$Tank<-as.factor(juv_sa_surv$Tank)
juv_sa_surv$Treatment<-as.factor(juv_sa_surv$Treatment)
juv_sa_surv$Time<-as.factor(juv_sa_surv$Time)
juv_sa_surv$Juvenile.ID<-as.factor(juv_sa_surv$Juvenile.ID)
juv_sa_surv$Date<-as.Date(juv_sa_surv$Date)
juv_sa_surv
```
```{r}
# Filter for surviving corals and count by date
juv_sa_surv_survived <- juv_sa_surv %>%
  #filter(Survival..0...dead..1...alive. == "1") %>%
  group_by(Date, Treatment, Tank) %>%
  dplyr::summarise(survived_count = sum(Survival..0...dead..1...alive. == "1"),
                    total_count = n())%>%
  mutate(survival_percentage = (survived_count / total_count) * 100)
juv_sa_surv_survived
juv_sa_surv_survived_sum <- juv_sa_surv_survived %>%
  #filter(Survival..0...dead..1...alive. == "1") %>%
  group_by(Date, Treatment) %>%
  dplyr::summarize(
    mean_survival = mean(survival_percentage, na.rm = TRUE),
    se_survival = sd(survival_percentage, na.rm = TRUE) / sqrt(n()))
juv_sa_surv_survived_sum
```
```{r}
juv_sa_surv_died <- juv_sa_surv %>%
  group_by(Date, Treatment) %>%
  dplyr::summarise(Died_count = sum(Survival..0...dead..1...alive. == "0"),
                    total_count = n())
juv_sa_surv_died
```

####Figure
```{r}
juv_sa_survival_figure<-ggplot(juv_sa_surv_survived_sum, aes(y=mean_survival, x=Date, color=Treatment, fill=Treatment))+ 
  #geom_point(data=juv_sa_alive, aes(y=Percent.change.per.day,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=2,stat="identity")+
  geom_line(aes(group = interaction(Treatment), stat="identity"))+
  geom_ribbon(aes(ymin=mean_survival-se_survival, ymax=mean_survival+se_survival), alpha=0.4, color=NA)+
  #geom_smooth()+
  #geom_errorbar(aes(ymin=Percent.change.per.day-se, ymax=Percent.change.per.day+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Juvenile~coral~survival~"(%)"), expand = c(0.01,0.01), limits=c(0,100))+ 
  #scale_x_date(limitsbreaks="15 days")+
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
   scale_fill_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #geom_hline(yintercept = 0, linetype = 1, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_blank(),
        axis.title.y = element_text(vjust=0.5, size=12))
juv_sa_survival_figure
```
```{r}
library(cowplot)
ph_survival<-cowplot::plot_grid(juv_sa_survival_figure,juv_sa_figure,juv_sa_figure2,bw_figure2,sa_figure2,nrow=3,ncol=3,align="h", axis = "bt")
ph_survival
```

####Stats
```{r}
survival<- glm(Survival..0...dead..1...alive. ~ Treatment*Time, data = juv_sa_surv, family = "binomial")
#summary(endolith)
car::Anova(survival, type=3)
```
```{r}
library(survival)
library(devtools)

# Kaplan Meier Survival Curve
km <- with(juv_sa_surv, Surv(Day, Survival..0...dead..1...alive.))
km_fit <- survfit(Surv(Day, Survival..0...dead..1...alive.) ~ Treatment, data=juv_sa_surv)
summary(km_fit, times = c(1,30,60,90*(1:10)))
#autoplot(km_fit)
```
#Metadata
```{r}
meta<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/meta_data_juvenile.csv", strip.white=T)
meta
```

#Gantry map
```{r}
map<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/gantry_map - original.csv", strip.white=T)
map$id<-as.factor(map$id)
map <- map %>%
  mutate(Boundary = paste(row, column))%>%
  mutate(Boundary = gsub(" _", "", Boundary))
map<- merge(meta, map, by=c("id"), all=T)
map
```
#Spencer data - T0

```{r}
polyp_T0<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu_project_T0_data_corals_polyps.csv", strip.white=T)
polyp_T0

# Extract the polyp numbers using a regular expression
#polyp_T0$Polyp_Number <- as.numeric(sub(".*_polyp_(\\d+)", "\\1", polyp_T0$Shape))
polyp_T0 <- polyp_T0 %>%
  separate(Shape, into = c("Boundary","Coral.ID", "Polyp", "Polyp_number"), sep = c(3, 7, 13, 15))
polyp_T0$Polyp_number<- as.numeric(polyp_T0$Polyp_number)
polyp_T0$Boundary<-as.factor(polyp_T0$Boundary)
polyp_T0$Coral.ID<-as.factor(polyp_T0$Coral.ID)

# Find the maximum polyp number
df_max_polyp_per_group <- polyp_T0 %>%
  dplyr::group_by(Boundary, Coral.ID) %>%
  dplyr::summarize(Max_Polyp_Number = max(Polyp_number, na.rm = TRUE)) %>%
  ungroup()%>%
  mutate(Max_Polyp_Number = na_if(Max_Polyp_Number, -Inf))
df_max_polyp_per_group
```


```{r}
library(stringr)
juv_sa_spencer_T0<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu_project_T0_data_corals_measurements.csv", strip.white=T)
juv_sa_spencer_T0$Boundary<-as.factor(juv_sa_spencer_T0$Boundary)
juv_sa_spencer_T0 <- juv_sa_spencer_T0 %>%
  separate(Boundary, into = c("Boundary","Coral.ID", "Survival", "Replicate", "Bleaching_status"), sep = c(3, 7, 8, 9))
juv_sa_spencer_T0<- merge(juv_sa_spencer_T0, map, by=c("Boundary"), all=T)
#juv_sa_spencer_T0<- merge(juv_sa_spencer_T0, df_max_polyp_per_group, by=c("Boundary","Coral.ID"), all=T)

juv_sa_spencer_T0 <- juv_sa_spencer_T0 %>% mutate(
    Survival = case_when(
      Survival == "A" ~ 1,
      Survival == "D" ~ 0,
      TRUE ~ as.numeric(Survival)))
juv_sa_spencer_T0$Treatment<-as.factor(juv_sa_spencer_T0$Treatment)
juv_sa_spencer_T0$Chunk<-as.factor(juv_sa_spencer_T0$Chunk)
juv_sa_spencer_T0 <- na.omit(juv_sa_spencer_T0)
juv_sa_spencer_T0
```
```{r}
polyp_T2<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu_project_T2_data_corals_polyps.csv", strip.white=T)
polyp_T2

# Extract the polyp numbers using a regular expression
#polyp_T2$Polyp_Number <- as.numeric(sub(".*_polyp_(\\d+)", "\\1", polyp_T2$Shape))
polyp_T2 <- polyp_T2 %>%
  separate(Shape, into = c("Boundary","Coral.ID", "Polyp", "Polyp_number"), sep = c(3, 7, 13, 15))
polyp_T2$Polyp_number<- as.numeric(polyp_T2$Polyp_number)
polyp_T2$Boundary<-as.factor(polyp_T2$Boundary)
polyp_T2$Coral.ID<-as.factor(polyp_T2$Coral.ID)

# Find the maximum polyp number
df_max_polyp_per_group_T2 <- polyp_T2 %>%
  dplyr::group_by(Boundary, Coral.ID) %>%
  dplyr::summarize(Max_Polyp_Number = max(Polyp_number, na.rm = TRUE)) %>%
  ungroup()%>%
  mutate(Max_Polyp_Number = na_if(Max_Polyp_Number, -Inf))
df_max_polyp_per_group_T2
```


#Spencer data - T2
```{r}
juv_sa_spencer_T2<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu_project_T2_data_corals_measurements.csv", strip.white=T)
juv_sa_spencer_T2$Boundary<-as.factor(juv_sa_spencer_T2$Boundary)
juv_sa_spencer_T2 <- juv_sa_spencer_T2 %>%
  separate(Boundary, into = c("Boundary","Coral.ID", "Survival", "Replicate", "Bleaching_status"), sep = c(3, 7, 8, 9))
juv_sa_spencer_T2<- merge(juv_sa_spencer_T2, map, by=c("Boundary"), all=T)
#juv_sa_spencer_T2<- merge(juv_sa_spencer_T2, df_max_polyp_per_group_T2, by=c("Boundary","Coral.ID"), all=T)

juv_sa_spencer_T2 <- juv_sa_spencer_T2 %>% mutate(
    Survival = case_when(
      Survival == "A" ~ 1,
      Survival == "D" ~ 0,
      TRUE ~ as.numeric(Survival)))
juv_sa_spencer_T2$Treatment<-as.factor(juv_sa_spencer_T2$Treatment)
juv_sa_spencer_T2$Chunk<-as.factor(juv_sa_spencer_T2$Chunk)
juv_sa_spencer_T2 <- na.omit(juv_sa_spencer_T2)
juv_sa_spencer_T2
```

```{r}
colnames(juv_sa_spencer_T0)
```

```{r}
juv_sa_spencer_all<- merge(juv_sa_spencer_T0, juv_sa_spencer_T2, by=c("Boundary", "Chunk", "Model", "Model.type", "Coral.ID", "Survival", 
  "Replicate", "Bleaching_status", "Surface.Area..mm.2.", "Area..mm.2.", 
  "Surface.Area..m.2..by.color.category..0", "Surface.Area..m.2..by.color.category..1", 
  "Surface.Area..m.2..by.color.category..2", "Surface.Area..m.2..by.color.category..3", 
  "Surface.Area..m.2..by.color.category..4", "Surface.Area..m.2..by.color.category..5", 
  "Surface.Area..m.2..by.color.category..6", "Surface.Area..m.2..by.color.category..7", 
  "Surface.Area..m.2..by.color.category..8", "Surface.Area..m.2..by.color.category..9", 
  "Surface.Area..m.2..by.color.category..10", "Surface.Area..m.2..by.color.category..11", 
  "Surface.Area..m.2..by.color.category..12", "Surface.Area..m.2..by.color.category..13", 
  "Surface.Area..m.2..by.color.category..14", "Surface.Area..m.2..by.color.category..15", 
  "Surface.Area..m.2..by.color.category..16", "Surface.Area..m.2..by.color.category..17", 
  "Surface.Area..m.2..by.color.category..18", "Surface.Area..m.2..by.color.category..19", 
  "Surface.Area..m.2..by.color.category..20", "Surface.Area..m.2..by.color.category..21", 
  "Surface.Area..m.2..by.color.category..22", "Surface.Area..m.2..by.color.category..23", 
  "Surface.Area..m.2..by.color.category..24", "Surface.Area..m.2..by.color.category..25", 
  "Surface.Area..m.2..by.color.category..26", "Surface.Area..m.2..by.color.category..27", 
  "Surface.Area..m.2..by.color.category..28", "Surface.Area..m.2..by.color.category..29", 
  "Surface.Area..m.2..by.color.category..30", "Surface.Area..m.2..by.color.category..31", 
  "Surface.Area..m.2..by.color.category..32", "Surface.Area..m.2..by.color.category..33", 
  "Surface.Area..m.2..by.color.category..34", "Surface.Area..m.2..by.color.category..35", 
  "Max.height..mm.", "Min.height..mm.", "Height.range..mm.", "Extent.Volume..mm.3.", 
  "Perimeter.2D..mm.", "Perimeter.3D..mm.", "Circularity.2D..mm.", "id", "Tank", 
  "Treatment", "column", "row"
), all=T)
juv_sa_spencer_all$Coral.ID<-as.factor(juv_sa_spencer_all$Coral.ID)
juv_sa_spencer_all$id<-as.factor(juv_sa_spencer_all$id)
juv_sa_spencer_color<-juv_sa_spencer_all
juv_sa_spencer_all <- juv_sa_spencer_all[, -c(11:46)]
cols_to_move <- colnames(juv_sa_spencer_all)[19:22]
target_position <- 5
new_order <- c(
  colnames(juv_sa_spencer_all)[1:(target_position-1)],   # Columns before the target position
  cols_to_move,                          # Columns to move
  colnames(juv_sa_spencer_all)[-c(1:(target_position-1), 19:22)] # Remaining columns
)
#new_order

# Rearrange the dataframe
juv_sa_spencer_all <- juv_sa_spencer_all %>% dplyr::select(all_of(new_order))
juv_sa_spencer_all <- juv_sa_spencer_all[, -12]
juv_sa_spencer_all
```
```{r}
juv_sa_spencer_all$SA_Vol_Ratio <- juv_sa_spencer_all$Area..mm.2./juv_sa_spencer_all$Extent.Volume..mm.3.
```

```{r}
colnames(juv_sa_spencer_all)
```

```{r}
# Split data by timepoints
df_t0 <- juv_sa_spencer_all %>% 
  filter(Chunk == "T0") %>% 
  dplyr::select(-Chunk)
df_t0
df_t2 <- juv_sa_spencer_all %>% 
  filter(Chunk == "T2") %>% 
  dplyr::select(-Chunk)
df_t2

# Function to rename columns
rename_columns <- function(df, suffix) {
  cols_to_rename <- setdiff(names(df), c("id", "Coral.ID", "Treatment", "Tank"))
  names(df)[names(df) %in% cols_to_rename] <- paste0(names(df)[names(df) %in% cols_to_rename], suffix)
  return(df)
}

# Rename columns in df_t0
df_t0 <- rename_columns(df_t0, "_T0")

# Rename columns in df_t2
df_t2 <- rename_columns(df_t2, "_T2")

 


# Rename columns to identify the timepoints
#df_t0 <- df_t0 %>% rename_with(~ paste0(., "_T0"), -matches("id |Coral.ID| Treatment| Tank"))
#df_t2 <- df_t2 %>% rename_with(~ paste0(., "_T2"), -matches("id |Coral.ID| Treatment| Tank"))

# Merge data by ID (assuming ID is a unique identifier for each observation)
df_combined <- merge(df_t0, df_t2, by=c("id","Coral.ID", "Treatment", "Tank"), all=T)
df_combined<- df_combined%>%
  filter(Survival_T2 != "0")
df_percent_change_per_day <- df_combined %>%
  mutate(
    Surface.Area..mm.2._percent_change_per_day = (((Surface.Area..mm.2._T2 - Surface.Area..mm.2._T0) / Surface.Area..mm.2._T0) * 100) / 56,
    Area..mm.2._percent_change_per_day = (((Area..mm.2._T2 - Area..mm.2._T0) / Area..mm.2._T0) * 100) / 56,
    Max.height..mm._percent_change_per_day = (((Max.height..mm._T2 - Max.height..mm._T0) / Max.height..mm._T0) * 100) / 56,
    Min.height..mm._percent_change_per_day = (((Min.height..mm._T2 - Min.height..mm._T0) / Min.height..mm._T0) * 100) / 56,
    Height.range..mm._percent_change_per_day = (((Height.range..mm._T2 - Height.range..mm._T0) / Height.range..mm._T0) * 100) / 56,
    Extent.Volume..mm.3._percent_change_per_day = (((Extent.Volume..mm.3._T2 - Extent.Volume..mm.3._T0) / Extent.Volume..mm.3._T0) * 100) / 56,
    Perimeter.2D..mm._percent_change_per_day = (((Perimeter.2D..mm._T2 - Perimeter.2D..mm._T0) / Perimeter.2D..mm._T0) * 100) / 56,
    Perimeter.3D..mm._percent_change_per_day = (((Perimeter.3D..mm._T2 - Perimeter.3D..mm._T0) / Perimeter.3D..mm._T0) * 100) / 56,
    Circularity.2D..mm._percent_change_per_day = (((Circularity.2D..mm._T2 - Circularity.2D..mm._T0) / Circularity.2D..mm._T0) * 100) / 56, SA_Vol_Ratio_percent_change_per_day = (((SA_Vol_Ratio_T2 - SA_Vol_Ratio_T0) / SA_Vol_Ratio_T0) * 100) / 56
    #Polyp_number_percent_change_per_day = (((Max_Polyp_Number_T2 - Max_Polyp_Number_T0) / Max_Polyp_Number_T0) * 100) / 56
  )
df_percent_change_per_day
#df_percent_change <- na.omit(df_percent_change)
df_percent_change_per_day$Tank<- as.factor(df_percent_change_per_day$Tank)
```
##Juvenile Coral Volume

###Normality
```{r}
hist(df_percent_change_per_day$Extent.Volume..mm.3._percent_change_per_day)
```

```{r}
sa.lm<- lm(Extent.Volume..mm.3._percent_change_per_day~Treatment, data=df_percent_change_per_day) #Gaussian
par(mfrow=c(2,3))
plot(sa.lm, ask=FALSE, which=1:6)
```

####Stats
```{r}
juv_sa.lme<- lme(Extent.Volume..mm.3._percent_change_per_day~Treatment,random=~1|Tank, data=df_percent_change_per_day, na.action = na.exclude)
Anova(juv_sa.lme, type=2)
tukey<- emmeans(juv_sa.lme, list(pairwise ~Treatment), adjust = "tukey")
tukey
```
```{r}
juv_sa_sum<-summarySE(df_percent_change_per_day, measurevar='Extent.Volume..mm.3._percent_change_per_day', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
juv_sa_sum
```
####Figure
```{r}
juv_sa_figure2<-ggplot(juv_sa_sum, aes(y=Extent.Volume..mm.3._percent_change_per_day, x=Treatment, color=Treatment))+ 
  #geom_point(data=df_percent_change_per_day, aes(y=Extent.Volume..mm.3._percent_change_per_day,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=Extent.Volume..mm.3._percent_change_per_day-se, ymax=Extent.Volume..mm.3._percent_change_per_day+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Percent~change~'in'~volume~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01))+ 
  scale_color_manual("Treatment", values=c("control"= '#9ecae1', "limu"="#a50f15"))+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
juv_sa_figure2
```
##Juvenile coral surface area
###Normality
```{r}
hist(df_percent_change_per_day$Area..mm.2._percent_change_per_day)
```

```{r}
sa.lm<- lm(Area..mm.2._percent_change_per_day~Treatment, data=df_percent_change_per_day) #Gaussian
par(mfrow=c(2,3))
plot(sa.lm, ask=FALSE, which=1:6)
```

####Stats
```{r}
juv_sa.lme<- lme(Area..mm.2._percent_change_per_day~Treatment,random=~1|Tank, data=df_percent_change_per_day, na.action = na.exclude)
Anova(juv_sa.lme, type=2)
tukey<- emmeans(juv_sa.lme, list(pairwise ~Treatment), adjust = "tukey")
tukey
```
```{r}
juv_sa_sum<-summarySE(df_percent_change_per_day, measurevar='Area..mm.2._percent_change_per_day', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
juv_sa_sum
```
####Figure
```{r}
juv_sa_figure<-ggplot(juv_sa_sum, aes(y=Area..mm.2._percent_change_per_day, x=Treatment, color=Treatment))+ 
  #geom_point(data=juv_sa, aes(y=Percent.change.per.day,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=Area..mm.2._percent_change_per_day-se, ymax=Area..mm.2._percent_change_per_day+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Percent~change~'in'~surface~area~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01))+ 
 scale_color_manual("Treatment", values=c("control"= '#9ecae1', "limu"="#a50f15"))+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
juv_sa_figure
```
##Juvenile coral SA:Vol ratio


###Normality
```{r}
hist(df_percent_change_per_day$SA_Vol_Ratio_percent_change_per_day)
```

```{r}
sa.lm<- lm(SA_Vol_Ratio_percent_change_per_day~Treatment, data=df_percent_change_per_day) #Gaussian
par(mfrow=c(2,3))
plot(sa.lm, ask=FALSE, which=1:6)
```

####Stats
```{r}
juv_sa.lme<- lm(SA_Vol_Ratio_percent_change_per_day~Treatment, data=df_percent_change_per_day, na.action = na.exclude)
Anova(juv_sa.lme, type=2)
tukey<- emmeans(juv_sa.lme, list(pairwise ~Treatment), adjust = "tukey")
tukey
```
```{r}
juv_sa_sum<-summarySE(df_percent_change_per_day, measurevar='SA_Vol_Ratio_percent_change_per_day', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
juv_sa_sum
```
####Figure
```{r}
juv_sa_figure2<-ggplot(juv_sa_sum, aes(y=SA_Vol_Ratio_percent_change_per_day, x=Treatment, color=Treatment))+ 
  #geom_point(data=df_percent_change_per_day, aes(y=Extent.Volume..mm.3._percent_change_per_day,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=SA_Vol_Ratio_percent_change_per_day-se, ymax=SA_Vol_Ratio_percent_change_per_day+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Percent~change~'in'~surface~area~volume~ratio~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01), limits=c(0,0.65))+ 
  scale_color_manual("Treatment", values=c("control"= '#9ecae1', "limu"="#a50f15"))+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
juv_sa_figure2
```
```{r}
colnames(juv_sa_spencer_all)
```

#Juvenile coral PCA
```{r}
colnames(df_percent_change_per_day)
df_percent_change_per_day_pca <- na.omit(df_percent_change_per_day)
```

```{r}
library(vegan)
selected_columns <- df_percent_change_per_day_pca[, c(27,38:46)]
juv.rda2<- rda(selected_columns, na.rm=TRUE, scale=TRUE)
```

```{r}
biplot(juv.rda2, scaling=1, main='Scaling')
```

```{r}
pca.sites.scores<- as.data.frame(scores(juv.rda2, display='sites'))
pca.sites.scores<- data.frame(pca.sites.scores,df_percent_change_per_day_pca )
pca.species.scores<- as.data.frame(scores(juv.rda2, display='species'))
pca.species.scores$Species<- rownames(pca.species.scores)
pca.species.scores
```
```{r}
eig<-eigenvals(juv.rda2)
eig
```
```{r}
g<-ggplot()+
  geom_point(data=pca.sites.scores, aes(y=PC2, x=PC1, color=Treatment), size=3, alpha=0.8)+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "darkgray") + 
  geom_vline(xintercept = 0, linetype = 2, alpha = 0.8, color = "darkgray") +
  geom_segment(data=pca.species.scores, aes(y=0, x=0, yend=PC2, xend=PC1), arrow=arrow(length=unit(0.3, 'lines')),color='black', linetype='solid',alpha=0.9)+
  geom_text(data=pca.species.scores, aes(y=PC2, x=PC1, label=Species), color="black")+
   scale_color_manual("Treatment", values=c("control"= '#0A4D68', "limu"="#90C8AC"))+
  #scale_color_manual("Year", values=c("2019"='coral2',"2020"='paleturquoise2',"2021"='darkslategray4'))+ #Manually choose the colors   
  #scale_shape_manual("Bleach", values=c("Bleach"=(pch=8),"Non-bleach"=(pch=16)))+ #Manually choose the colors
  scale_x_continuous(paste(names(eig[1]), sprintf('(%0.1f%% explained var.)', 100 * eig[1]/sum(eig))))+
  scale_y_continuous(limits=c(-2,2),paste(names(eig[2]), sprintf('(%0.1f%% explained var.)', 100 * eig[2]/sum(eig))))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_text(size=12),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(size=12, face="italic"))
g
```
```{r}
permanova<-adonis(selected_columns ~ Treatment, data=df_percent_change_per_day_pca, permutations=9999)
#permanova
library(pairwiseAdonis)
pairwise.adonis2(selected_columns ~Treatment, data=df_percent_change_per_day_pca, permutations = 9999, na.rm=T)
```
##Juvenile color PCA
```{r}
#colnames(juv_sa_spencer_color)#11-46
```

```{r}
#colnames(df_percent_change_per_day)
#df_percent_change_per_day_pca <- na.omit(df_percent_change_per_day)
```

```{r}
library(vegan)
#juv_sa_spencer_color_0 <- juv_sa_spencer_color[, colSums(juv_sa_spencer_color != 0) > 0]
#colnames(juv_sa_spencer_color_0)
selected_columns_color <- juv_sa_spencer_color[, c(11:46)]
color.rda<- rda(selected_columns_color, na.rm=TRUE, scale=TRUE)
```

```{r}
biplot(color.rda, scaling=1, main='Scaling')
```

```{r}
permanova2<-adonis(selected_columns_color ~ Treatment*Chunk, data=juv_sa_spencer_color, permutations=9999)
#permanova
library(pairwiseAdonis)
pairwise.adonis2(selected_columns_color ~ Treatment*Chunk, data=juv_sa_spencer_color, permutations = 9999, na.rm=T)
```
```{r}
pca.sites.scores<- as.data.frame(scores(color.rda, display='sites'))
pca.sites.scores<- data.frame(pca.sites.scores,juv_sa_spencer_color )
pca.species.scores<- as.data.frame(scores(color.rda, display='species'))
pca.species.scores$Species<- rownames(pca.species.scores)
pca.species.scores
```
```{r}
eig<-eigenvals(color.rda)
eig
```
```{r}
g<-ggplot()+
  geom_point(data=pca.sites.scores, aes(y=PC2, x=PC1, color=Treatment), size=3, alpha=0.8)+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "darkgray") + 
  geom_vline(xintercept = 0, linetype = 2, alpha = 0.8, color = "darkgray") +
  facet_wrap(~Chunk)+
  #geom_segment(data=pca.species.scores, aes(y=0, x=0, yend=PC2, xend=PC1), arrow=arrow(length=unit(0.3, 'lines')),color='black', linetype='solid',alpha=0.9)+
  #geom_text(data=pca.species.scores, aes(y=PC2, x=PC1, label=Species), color="black")+
   scale_color_manual("Treatment", values=c("control"= '#0A4D68', "limu"="#90C8AC"))+
  #scale_color_manual("Year", values=c("2019"='coral2',"2020"='paleturquoise2',"2021"='darkslategray4'))+ #Manually choose the colors   
  #scale_shape_manual("Bleach", values=c("Bleach"=(pch=8),"Non-bleach"=(pch=16)))+ #Manually choose the colors
  scale_x_continuous(paste(names(eig[1]), sprintf('(%0.1f%% explained var.)', 100 * eig[1]/sum(eig))))+
  scale_y_continuous(limits=c(-2,2),paste(names(eig[2]), sprintf('(%0.1f%% explained var.)', 100 * eig[2]/sum(eig))))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_text(size=12),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(size=12, face="italic"))
g
```

##Juvenile coral surface area

```{r}
juv_sa<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Juvenile surface area - change revised by Julia.csv", strip.white=T)
juv_sa$Tank<-as.factor(juv_sa$Tank)
juv_sa$Treatment<-as.factor(juv_sa$Treatment)
juv_sa$Juvenile.ID<-as.factor(juv_sa$Juvenile.ID)
juv_sa_alive <- filter(juv_sa, Survival..0...dead..1...alive. == c("1"))
juv_sa
```
###All corals
```{r}
hist(juv_sa$Percent.change.per.day_end)
```
```{r}
juv_sa.lm<- lm(Percent.change.per.day_end~Treatment,random=~1|Tank, data=juv_sa, na.action = na.exclude)
par(mfrow=c(2,3))
plot(juv_sa.lm, ask=FALSE, which=1:6)
```
####Stats
```{r}
juv_sa.lme<- lme(Percent.change.per.day_end~Treatment,random=~1|Tank, data=juv_sa, na.action = na.exclude)
Anova(juv_sa.lme, type=2)
tukey<- emmeans(juv_sa.lme, list(pairwise ~Treatment), adjust = "tukey")
tukey
```
```{r}
juv_sa_sum<-summarySE(juv_sa, measurevar='Percent.change.per.day_end', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
juv_sa_sum
```
####Figure
```{r}
juv_sa_figure2<-ggplot(juv_sa_sum, aes(y=Percent.change.per.day_end, x=Treatment, color=Treatment))+ 
  #geom_point(data=juv_sa, aes(y=Percent.change.per.day,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=Percent.change.per.day_end-se, ymax=Percent.change.per.day_end+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Relative~change~'in'~surface~area~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01),breaks=c(-0.2,-0.1,0,0.1,0.2,0.3,0.4), limits=c(-0.2,0.4))+ 
  scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
juv_sa_figure2
```
###Alive only 
```{r}
hist(juv_sa_alive$Percent.change.per.day_end)
```
```{r}
juv_sa_alive.lm<- lm(Percent.change.per.day_end~Treatment,random=~1|Tank, data=juv_sa_alive, na.action = na.exclude)
par(mfrow=c(2,3))
plot(juv_sa_alive.lm, ask=FALSE, which=1:6)
```
####Stats
```{r}
juv_sa_alive.lme<- lme(Percent.change.per.day_end~Treatment,random=~1|Tank, data=juv_sa_alive, na.action = na.exclude)
Anova(juv_sa_alive.lme, type=2)
tukey<- emmeans(juv_sa_alive.lme, list(pairwise ~Treatment), adjust = "tukey")
tukey
```
```{r}
juv_sa_alive_sum<-summarySE(juv_sa_alive, measurevar='Percent.change.per.day_end', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
juv_sa_alive_sum
```
####Figure
```{r}
juv_sa_alive_figure2<-ggplot(juv_sa_alive_sum, aes(y=Percent.change.per.day_end, x=Treatment, color=Treatment))+ 
  #geom_point(data=juv_sa_alive, aes(y=Percent.change.per.day,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=Percent.change.per.day_end-se, ymax=Percent.change.per.day_end+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Relative~change~'in'~surface~area~of~live~corals~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01),breaks=c(-0.2,-0.1,0,0.1,0.2,0.3,0.4), limits=c(-0.2,0.4))+ 
  scale_color_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
juv_sa_alive_figure2
```
```{r}
library(cowplot)
juv_both<-cowplot::plot_grid(juv_sa_figure2,juv_sa_alive_figure2,nrow=1,ncol=2,align="h", axis = "bt")
juv_both
```


```{r}
juv_sa_figure<- ggplot(juv_sa, (aes(y=Percent.change.per.day, x=Treatment, fill=Treatment)))+  
  geom_boxplot(coef=1.5)+
  geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  scale_fill_manual("Treatment", values=c("Control"= '#0A4D68', "Limu"="#90C8AC"))+
  theme_classic()+
  #scale_y_continuous(expression(Relative~change~'in'~net~calcification~("%"~Delta~'\U2219'~day^{-1})), expand = c(0.01,0.01))+ 
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
juv_sa_figure
```
##Limu Weight

```{r}
limu_fw<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Limu weights.csv", strip.white=T)
limu_fw$Tank<-as.factor(limu_fw$Tank)
limu_fw$Week<-as.factor(limu_fw$Week)
limu_fw<- plyr::rename(limu_fw, c("Limu.start.weight..g."="Start","Limu.end.weight..g."="End"))
limu_fw <- limu_fw %>%
  pivot_longer(cols = c(Start, End),  # Columns to pivot
               names_to = "Limu",           # New column name for the identifiers
               values_to = "Weight") 
limu_fw$Limu<-as.factor(limu_fw$Limu)
limu_fw
```
```{r}
hist(limu_fw$Weight)
```


```{r}
fw.lm<- lm(Weight~Week*Limu,random=~1|Tank, data=limu_fw, na.action = na.exclude)
par(mfrow=c(2,3))
plot(fw.lm, ask=FALSE, which=1:6)
```
####Stats
```{r}
fw.lme<- lme(Weight~Limu*Week,random=~1|Tank, data=limu_fw, na.action = na.exclude)
Anova(fw.lme)
tukey<- emmeans(fw.lme, list(pairwise ~Limu*Week), adjust = "tukey", simple="Limu")
tukey
```
```{r}
fw_sum<-summarySE(limu_fw, measurevar='Weight', groupvars=c('Limu', 'Week'), na.rm=TRUE, conf.interval = 0.95)
fw_sum
```
###Figure
```{r}
fw_sum$Limu<- factor(fw_sum$Limu, levels =c("Start","End"))
fw_figure2<- ggplot(fw_sum, (aes(y=Weight, x=Limu, linetype=Week, group = interaction(Week))))+  
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=Weight-se, ymax=Weight+se, width= 0.1),stat="identity") +
  geom_path()+ 
  scale_y_continuous(expression(Fresh~weight~(g)))+  
  #scale_color_manual("Treatment", values=c("New"= 'black', "Old"="darkgrey"))+
  #scale_color_brewer(palette="Reds")+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        #legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
fw_figure2
```
```{r}
fw_sum2<-summarySE(limu_fw, measurevar='Weight', groupvars=c('Limu'), na.rm=TRUE, conf.interval = 0.95)
fw_sum2
```
###Figure
```{r}
fw_sum2$Limu<- factor(fw_sum2$Limu, levels =c("Start","End"))
fw_figure3<- ggplot(fw_sum2, (aes(y=Weight, x=Limu)))+  
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=Weight-se, ymax=Weight+se, width= 0.1),stat="identity") +
  geom_path()+ 
  scale_y_continuous(expression(Fresh~weight~(g)))+  
  #scale_color_manual("Treatment", values=c("New"= 'black', "Old"="darkgrey"))+
  #scale_color_brewer(palette="Reds")+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        #legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
fw_figure3
```

##Limu PAM 

```{r}
limu_pam<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/PAM data- limu.csv", strip.white=T)
limu_pam$Tank<-as.factor(limu_pam$Tank)
limu_pam$Limu<-as.factor(limu_pam$Limu)
limu_pam$Date<-as.Date(limu_pam$Date)
limu_pam  <- limu_pam %>%
  mutate(Week = week(ymd(Date)))
limu_pam_filtered <- limu_pam %>%
  group_by(Date, Limu, Tank) %>%
  slice(5:6) %>%
  ungroup()
limu_pam_filtered
```


```{r}
diff_df <- limu_pam_filtered %>%
  dplyr::group_by(Date, Tank, Limu, Week) %>%
  dplyr::filter(n() >= 2) %>%  # Ensure there are at least two rows in each group
  dplyr::summarise(Yield = (nth(Mean, 2) - nth(Mean, 1)) / nth(Mean, 2))
diff_df
diff_df_2 <- diff_df[-c(6,29,30), ]
diff_df_2
```
```{r}
hist(diff_df_2$Yield)
```
```{r}
#hist(diff_df_2$Yield)
diff_df_2 <-diff_df_2 %>%
 dplyr::filter(Week > 18)%>%
 dplyr::filter(Week < 26)
```

```{r}
pam.lm<- lm(Yield~Week*Limu,random=~1|Tank, data=diff_df_2, na.action = na.exclude)
par(mfrow=c(2,3))
plot(pam.lm, ask=FALSE, which=1:6)
```
####Stats
```{r}
diff_df_2$Week<-as.factor(diff_df_2$Week)
pam.lme<- lme(Yield~Limu*Week,random=~1|Tank, data=diff_df_2, na.action = na.exclude)
Anova(pam.lme)
tukey<- emmeans(pam.lme, list(pairwise ~Limu*Week), adjust = "tukey", simple="Week")
tukey
```
```{r}
PAR_himb_sum_week<-summarySE(PAR_himb_sum, measurevar='Calibrated.Value', groupvars=c("Week"), na.rm=TRUE, conf.interval = 0.95)
PAR_himb_sum_week
```


```{r}
pam_sum<-summarySE(diff_df_2, measurevar='Yield', groupvars=c("Date",'Limu', 'Week'), na.rm=TRUE, conf.interval = 0.95)
pam_sum
pam_himb_old <- diff_df_2 %>%
  filter(Limu != "New")
pam_himb_old
```
```{r}
pam_par<- merge(pam_himb_old, PAR_himb_sum_week, by=c("Week"), all=T)
pam_par
```

####Figure
```{r}
pam_par_figure<- ggplot(pam_par, (aes(y=Yield, x=Calibrated.Value)))+  
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  #geom_errorbar(aes(ymin=Yield-se, ymax=Yield+se, width= 0.5),  position=position_dodge(0.5,preserve = "single"),stat="identity") +
  #geom_path()+ 
  geom_smooth(method="gam", formula = y ~ s(x, bs = "cs", k=3))+
  scale_y_continuous(expression(Photosynthetic~yield~(Fv/Fm)))+  
  scale_x_continuous(expression(Photosynthetically~active~radiation~"(PAR)"), expand=c(0.015,0.015))+
  #scale_color_manual("Treatment", values=c("New"= 'black', "Old"="darkgrey"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        #legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
pam_par_figure
```
####Figure
```{r}
pam_figure<- ggplot(pam_sum, (aes(y=Yield, x=Date, color=Limu)))+  
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=Yield-se, ymax=Yield+se, width= 0.5),  position=position_dodge(0.5,preserve = "single"),stat="identity") +
  geom_path()+ 
  scale_y_continuous(expression(Photosynthetic~yield~(Fv/Fm)))+  
  scale_color_manual("Treatment", values=c("New"= 'black', "Old"="darkgrey"))+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        #legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
pam_figure
```
```{r}
pam_figure2<- ggplot(pam_sum, (aes(y=Yield, x=Limu, linetype=Week, group = interaction(Week))))+  
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=Yield-se, ymax=Yield+se, width= 0.1),stat="identity") +
  geom_path()+ 
  scale_y_continuous(expression(Photosynthetic~yield~(Fv/Fm)))+  
  #scale_color_manual("Treatment", values=c("New"= 'black', "Old"="darkgrey"))+
  #scale_color_brewer(palette="Reds")+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        #legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
pam_figure2
```
```{r}
pam_sum2<-summarySE(diff_df_2, measurevar='Yield', na.rm=TRUE, conf.interval = 0.95)
pam_sum2
```

```{r}
pam_figure3<- ggplot(pam_sum2, (aes(y=Yield, x=Limu)))+  
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=Yield-se, ymax=Yield+se, width= 0.1),stat="identity") +
  geom_path()+ 
  scale_y_continuous(expression(Photosynthetic~yield~(Fv/Fm)))+  
  #scale_color_manual("Treatment", values=c("New"= 'black', "Old"="darkgrey"))+
  #scale_color_brewer(palette="Reds")+
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        #legend.justification=c(1,1),
        #legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
pam_figure3
```

```{r}
library(cowplot)
limu_fig2<-plot_grid(fw_figure3,pam_figure3, ncol=2, nrow=1, align="h", axis = "bt") 
limu_fig2
```


##Coral PAM
```{r}
coral_pam<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Limu project/Coral PAM data.csv", strip.white=T)
coral_pam$Tank<-as.factor(coral_pam$Tank)
coral_pam$Treatment<-as.factor(coral_pam$Treatment)
coral_pam$Genotype<-as.factor(coral_pam$Genotype)
coral_pam_filtered <- coral_pam %>%
  group_by(Genotype, Tank) %>%
  slice(5:6) %>%
  ungroup()
coral_pam
coral_pam_filtered
```
```{r}
coral_diff_df <- coral_pam_filtered %>%
  dplyr::group_by(Treatment,Genotype, Tank) %>%
  dplyr::filter(n() >= 2) %>%  # Ensure there are at least two rows in each group
  dplyr::summarise(Yield = (nth(Mean, 2) - nth(Mean, 1)) / nth(Mean, 2))
coral_diff_df
```
```{r}
hist(coral_diff_df$Yield)
```
```{r}
coral_pam.lm<- lm(Yield~Treatment,random=~1|Tank, data=coral_diff_df, na.action = na.exclude)
par(mfrow=c(2,3))
plot(coral_pam.lm, ask=FALSE, which=1:6)
```
####Stats
```{r}
#diff_df_2$Week<-as.factor(diff_df_2$Week)
coral_pam.lme<- lme(Yield~Treatment,random=~1|Genotype/Tank, data=coral_diff_df, na.action = na.exclude)
Anova(coral_pam.lme)
tukey<- emmeans(coral_pam.lme, list(pairwise ~Treatment), adjust = "tukey")
tukey
```
```{r}
coral_pam_sum<-summarySE(coral_diff_df, measurevar='Yield', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
coral_pam_sum
```
###Figure
```{r}
#allcal$Light <- factor(allcal$Light, levels=c("Light","Dark"))
pam_figure2<-ggplot(coral_pam_sum, aes(y=Yield, x=Treatment, color=Treatment))+ 
  #geom_point(data=sa_wide_2, aes(y=PercentchangeDay,x=Treatment, color=Treatment),alpha=0.5,position=position_jitterdodge(0.05))+
  geom_point(size=3, position=position_dodge(0.5),stat="identity")+
  geom_errorbar(aes(ymin=Yield-se, ymax=Yield+se, width= 0.2),  position=position_dodge(0.5),stat="identity") +
  scale_y_continuous(expression(Photosynthetic~yield), expand = c(0.01,0.01))+ 
  scale_color_manual("Treatment", values=c("Control"= '#9ecae1', "Limu"="#a50f15"))+
  #geom_hline(yintercept = 0, linetype = 2, alpha = 0.8, color = "black") + 
  theme_classic()+
  theme(axis.text.x=element_text(hjust=0.5, size=12),
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.9),
        legend.justification=c(1,1),
        legend.position=c(1,1), 
        panel.background= element_rect(fill=NA, color='black'),
        legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=12),
        axis.title.y = element_text(vjust=0.5, size=12),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=10))
pam_figure2
```

```{r}
library(cowplot)
adult_figs<-cowplot::plot_grid(adult_survival_figure,bw_figure2,sa_figure2,vol_figure2,pam_figure2,nrow=3,ncol=3,align="h", axis = "bt")
adult_figs
```


